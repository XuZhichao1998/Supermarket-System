###  <font color="purple">超市管理系统-源代码</font>

#### Author: 许智超

---

SQLQuery1_build_supermarketDB.sql

```sql
use supermarketDB;
drop trigger if exists trig_UpdatePInventoryAfterChanged;
drop trigger if exists trig_InsertPInventoryAfterInsertProducts;
drop trigger if exists trig_AddProcntAfterInsertStro;
drop trigger if exists trig_insertStorAfterInsertPurchase;
drop trigger if exists tirg_updStorageAfterInsertSaleListDetail;
drop view if exists view_product_storage;
drop view if exists view_low_product_storage;
drop view if exists view_high_product_storage;
drop table if exists ErrorLogs;
drop table if exists SysAdmins;
drop table if exists SMMembers;
drop table if exists LoginLogs;
drop table if exists ReturnProduct;
drop table if exists ProductStorage;
drop table if exists SalesListDetail;
drop table if exists SalesList;
drop table if exists SalesPerson;
drop table if exists ProductInventory;
drop table if exists PurchaseCnt;
drop table if exists InventoryStatus;
drop table if exists Products;
drop table if exists ProductUnit;
drop table if exists ProductCategory;
--商品分类表
create table ProductCategory  --商品类别表
(
	CategoryId int identity(1,1) primary key ,--商品分类编号
	CategoryName varchar(20) not null--商品分类名称
)

--商品计量单位表
create table ProductUnit
(
	Id int identity(1,1) primary key ,
	Unit varchar(20) not null--商品计量单位
)
--商品表
create table Products
(
	ProductId varchar(50) primary key,--商品编号（商品条码）
	ProductName varchar(50) not null, --商品名称
	UnitPrice numeric(18,2) not null, --商品单价
	Unit varchar(50) not null,--计量单位(没有设置外键，需要插入的时候判断一下)
	Discount int,--折扣
	CategoryId int  references ProductCategory (CategoryId) not null --（商品分类）外键
)

--商品库存状态
create table InventoryStatus
(	
    StatusId int primary key,--库存状态
    StatusDesc varchar(50) not null--（1：正常，-1：低于库存，2：高于库存；-2：已清仓）
)
--进货记录表
create table Purchase
(
	PurchaseId int identity(100000,1) primary key, --进货记录流水号
	ProductId varchar(50) references Products(ProductId), --商品ID
	PurchasePrice numeric(18,2) not null, --进价
	PurchaseCnt int not null check(PurchaseCnt>0), --进货数量
	PurchaseTotPrice numeric(18,2) not null, --总进价
	PurchaseDate smalldatetime default(getdate()) not null --进货时间
);

--商品库存表
create table ProductInventory
(
	ProductId varchar(50) primary key,--商品编号
    TotalCount int not null,--总数量
    MinCount int not null,--最小库存
    MaxCount int not null,--最大库存
    StatusId int references InventoryStatus (StatusId) --库存状态（1：正常，-1：低于库存，2：高于库存；-2：已清仓）
)

--销售员(收银员)表
create table SalesPerson
(
	SalesPersonId int identity(10000,1) primary key,-- 自动标识
	SPName varchar(50) not null,
	LoginPwd varchar(50)  not null --最少6位  
)
--销售流水账表
create table SalesList
(  
	SerialNum varchar(50) primary key not null, --流水号(系统自动生成)
	TotalMoney numeric(10,2) not null,--购物总价钱
	RealReceive numeric(10,2) not null,--实际收款
	ReturnMoney  numeric(10,2) not null,--找零
	SalesPersonId int references SalesPerson (SalesPersonId), --销售员（外键）
	SaleDate smalldatetime  default(getdate()) not null --默认数据库服务器时间
)

--销售流水账明细
create table SalesListDetail
(
    Id int identity(1000000,1) primary key not  null,--自动标识列
    SerialNum varchar(50) references SalesList (SerialNum), --流水号（外键）
	ProductId varchar(50) not null, --商品编号（不需要外键）
	ProductName varchar(50) not null, --商品名称
	UnitPrice numeric(10,2) not null, --商品单价 
	Discount int,--折扣
	Quantity int not null,--销售数量	
    SubTotalMoney numeric(10,2)--小计金额
)


--商品入库表
create table ProductStorage
(
	StorageId int identity(100000,1) primary key,--标识列
	ProductId varchar(50) references Products (ProductId),--外键：商品编号
	AddedCount int not null,--入库数量
	CurrentTime smalldatetime default(getdate())  not null --默认数据库服务器时间
)
--退货表
use supermarketDB;
drop table if exists ReturnProduct;
create table ReturnProduct
(
	ReturnProductId int identity(10000,1) primary key,
	SerialNum varchar(50) references SalesList(SerialNum), --交易流水号
	ProductId varchar(50) references Products(ProductId), --商品编号
	rcnt int not null, --退货数量
	rMoney numeric(10,2),--退货金额
	rDate smalldatetime default(getdate()) not null
);

--登录日志表
create table LoginLogs
(
    LogId int identity(1,1) primary key, --登录流水号
	LoginId  int not null,
	SPName varchar(50),--登录人员姓名，可能是管理员登录或者是销售员登录
	ServerName varchar(100),--登录的服务器名称
	LoginTime datetime default(getdate()) not null, --默认数据库服务器时间  登录时刻
	ExitTime datetime --退出时间
)

--超市会员表
create table SMMembers
(
	MemberId int identity(100200300,1) primary key,--会员卡号
	MemberName varchar(50) not null,--会员姓名	
	Points int default(0) not null,--会员积分（消费10元，获得1个积分）
	PhoneNumber varchar(200) not null,--联系电话
	MemberAddress text not null,--联系地址
	OpenTime datetime default(getdate()),--开户时间
	MemberStatus int default(1) not null--会员卡状态（1：正常使用；0：冻结；-1：注销）
)
--select * from SMMembers;

--管理员表
create table SysAdmins
(
	LoginId int identity(2000,1) primary key,--登录账号
	LoginPwd varchar(20),--登录密码
	AdminName varchar(20),--管理员姓名
	AdminStatus bit, --当前状态（1：启用；0：禁用）
	RoleId int --角色编号（1：超级管理员；2：一般管理员）
)

--添加级联更新
if exists(select * from sysobjects where name='fk_ProductId_PI')
alter table ProductInventory drop constraint fk_ProductId_PI

alter table ProductInventory add constraint fk_ProductId_PI foreign key (ProductId) references Products (ProductId) on update cascade

--添加商品discount默认值
if exists(select * from sysobjects where name='df_ProductDiscountDefault')
alter table Products drop constraint df_ProductDiscountDefault

alter table Products add constraint df_ProductDiscountDefault default(1.0) for Discount

--添加商品Status默认值
if exists(select * from sysobjects where name='df_ProductStatusDefault')
alter table Products drop constraint df_ProductStatusDefault

create table ErrorLogs --错误日志表
(
	ErrorId int identity(1,1) primary key,
	OccurTime datetime default(getdate()),
	ServerName varchar(50) default('记录失败'),--不能因为错误记录而中止程序或报出错误，影响用户体验
	LoginId int,
	ErrorDesc text default('未知错误')
);
--drop view if exists view_product_storage;
go
create view view_product_storage as
select tb1.ProductId as '商品编号',ProductName as '名称',UnitPrice as '单价',Unit as '计量单位',TotalCount as '库存量',Discount as '折扣'
from Products as tb1,ProductInventory as tb2
where tb1.ProductId=tb2.ProductId;

--select * from view_product_storage;
go
create view view_low_product_storage as
select tb1.ProductId as '商品编号',ProductName as '名称',UnitPrice as '单价',Unit as '计量单位',TotalCount as '库存量',MinCount as '最少库存量',MaxCount as '最多库存量'
from Products as tb1,ProductInventory as tb2
where tb1.ProductId=tb2.ProductId and TotalCount < MinCount;

go
create view view_high_product_storage as
select tb1.ProductId as '商品编号',ProductName as '名称',UnitPrice as '单价',Unit as '计量单位',TotalCount as '库存量',MinCount as '最少库存量',MaxCount as '最多库存量'
from Products as tb1,ProductInventory as tb2
where tb1.ProductId=tb2.ProductId and TotalCount > MaxCount;


-- 添加购物小票明细后，更新库存，减少响应货物的库存数量
go
create trigger tirg_updStorageAfterInsertSaleListDetail on SalesListDetail after insert as
begin
	declare @Pid varchar(50),@cnt int
	set @Pid = (select ProductId from inserted)
	set @cnt = (select Quantity from inserted)
	update ProductInventory set TotalCount=TotalCount-@cnt where ProductId=@Pid;
	if @@ERROR<>0
		begin
			rollback
		end
end

--插入进货信息的时候，同时插入入库信息
go
create trigger trig_insertStorAfterInsertPurchase on Purchase after insert as
begin
	declare @pid varchar(50),@cnt int
	set @pid = (select ProductId from inserted)
	set @cnt = (select PurchaseCnt from inserted)
	insert into ProductStorage(ProductId,AddedCount,CurrentTime) values(@pid,@cnt,default)
	if @@ERROR<>0
		begin
			rollback
		end
end

--插入入库表的时候同时更新库存量
go
create trigger trig_AddProcntAfterInsertStro on ProductStorage after insert as
begin
	declare @pid varchar(50),@cnt int
	set @pid = (select ProductId from inserted)
	set @cnt = (select AddedCount from inserted)
	update ProductInventory set TotalCount=TotalCount+@cnt where ProductId=@Pid;
	if @@ERROR<>0
		begin
			rollback
		end
end

go 
--触发器：插入新的商品之后，向库存表中插入一条该商品库存量为0的记录
create trigger trig_InsertPInventoryAfterInsertProducts on Products after insert as
begin
	declare @pid varchar(50)
	set @pid = (select ProductId from inserted)
	insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values(@pid,0,50,200,-1);
	if @@ERROR<>0
		begin
			rollback
		end
end

go 
--触发器：库存改变的时候，更新库存状态：-1过少，2过多，1正常
create trigger trig_UpdatePInventoryAfterChanged on ProductInventory after update as
begin
	declare @pid varchar(50),@cnt int,@MinCnt int,@MaxCnt int,@Status int,@PreStatus int
	set @pid = (select ProductId from inserted)
	set @cnt = (select TotalCount from inserted)
	set @MinCnt = (select MinCount from inserted)
	set @MaxCnt = (select MaxCount from inserted)
	set @PreStatus = (select StatusId from inserted)
	if(@cnt < @MinCnt)
		begin
			set @Status=-1
		end
	else if(@cnt > @MaxCnt)
		begin
			set @Status=2
		end
	else
		begin
			set @Status=1
		end
	if(@Status<>@PreStatus)
		begin
			update ProductInventory set StatusId=@Status where ProductId=@pid;
		end
	if @@ERROR<>0
		begin
			rollback
		end
end


go
--一个存储过程。注销掉所有过期的会员账号
drop proc if exists proc_del_overdul_member;
go
create proc	proc_del_overdul_member as
	delete from SMMembers where DATEDIFF(day,OpenTime,getDate())>365;


```



SQLQuery_insert_supermarket.sql

```sql
use supermarketDB;
go
--管理员信息
insert into SysAdmins(LoginPwd,AdminName,AdminStatus,RoleId) values('xzc','许智超',1,2);
insert into SysAdmins(LoginPwd,AdminName,AdminStatus,RoleId) values('hjw','胡家伟',1,2);
insert into SysAdmins(LoginPwd,AdminName,AdminStatus,RoleId) values('jyy','金轶远',1,2);
insert into SysAdmins(LoginPwd,AdminName,AdminStatus,RoleId) values('ylb','杨老板',1,1);
insert into SysAdmins(LoginPwd,AdminName,AdminStatus,RoleId) values('zsf','张三风',0,2);


--收银员信息
insert into  SalesPerson(SPName,LoginPwd) values('Bob','123456');
insert into  SalesPerson(SPName,LoginPwd) values('Tom','123456');
insert into  SalesPerson(SPName,LoginPwd) values('Amy','123456');
select * from SalesPerson;
--超市会员信息---MemberId实际开发中不使用标识列而是使用刷卡录入卡号
insert into SMMembers(MemberName,Points,PhoneNumber,MemberAddress,OpenTime,MemberStatus)
values('郭靖',default,'173-6299-2401','襄阳',default,default);
insert into SMMembers(MemberName,Points,PhoneNumber,MemberAddress,OpenTime,MemberStatus)
values('黄蓉',default,'173-6299-2409','桃花岛',default,default);
insert into SMMembers(MemberName,Points,PhoneNumber,MemberAddress,OpenTime,MemberStatus)
values('杨过',default,'173-6299-2475','襄阳',default,default);
insert into SMMembers(MemberName,Points,PhoneNumber,MemberAddress,OpenTime,MemberStatus)
values('小龙女',default,'173-6299-2551','终南山',default,default);

--商品类别
insert into ProductCategory(CategoryName) values('饮料')--1
insert into ProductCategory(CategoryName) values('副食')--2
insert into ProductCategory(CategoryName) values('面食')--3
insert into ProductCategory(CategoryName) values('肉类')--4
insert into ProductCategory(CategoryName) values('米类')--5
insert into ProductCategory(CategoryName) values('酒类')--6
insert into ProductCategory(CategoryName) values('烟类')--7
insert into ProductCategory(CategoryName) values('文具')--8
insert into ProductCategory(CategoryName) values('玩具')--9
insert into ProductCategory(CategoryName) values('日用品')--10


--商品计量单位
insert into ProductUnit values('箱')
insert into ProductUnit values('瓶')
insert into ProductUnit values('盒')
insert into ProductUnit values('本')
insert into ProductUnit values('袋')
insert into ProductUnit values('只')
insert into ProductUnit values('条')
insert into ProductUnit values('桶')
insert into ProductUnit values('打')
insert into ProductUnit values('听')
insert into ProductUnit values('罐')
insert into ProductUnit values('张')
insert into ProductUnit values('块')
insert into ProductUnit values('床')
insert into ProductUnit values('把')
insert into ProductUnit values('台')
insert into ProductUnit values('个')

--商品信息
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003001','康师傅牛肉面',40.00,'箱',10,3)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003002','康师傅打卤面',35.00,'箱',10,3)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003003','康师傅三鲜面',38.00,'箱',10,3)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003004','统一牛肉面',36.00,'箱',10,3)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003005','统一酸菜面',42.00,'箱',10,3)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003006','雪花啤酒',60.50,'箱',10,6)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003007','燕京啤酒',60.00,'箱',10,6)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003008','可口可乐',6.80,'瓶',10,1)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003009','百事可乐',5.80,'瓶',10,1)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003010','统一鲜橙多',5.80,'瓶',10,1)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003011','茉莉花茶',3.50,'瓶',10,1)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003012','自制蛋糕',19.80,'盒',10,2)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003013','中型碳素笔',10.00,'盒',10,9)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003014','云南白药牙膏',6.80,'盒',10,10)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003015','东北大米',80.00,'袋',10,5)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003016','武昌大米',100.00,'袋',10,5)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003017','高精面粉',68.50,'袋',10,3)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003018','大豆油',68.80,'桶',10,2)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003019','纯棉毛巾',8.80,'条',10,10)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003020','金龙鱼食用油',55.80,'桶',10,2)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003021','鲈鱼',39.90,'条',10,4)
insert into Products (ProductId,ProductName,UnitPrice,Unit,Discount,categoryId)
values('6005004003022','草鱼',35.90,'条',10,4)

--商品库存状态
insert into InventoryStatus(StatusId,StatusDesc)values(1,'正常')
insert into InventoryStatus(StatusId,StatusDesc)values(-1,'低于库存')
insert into InventoryStatus(StatusId,StatusDesc)values(2,'高于库存')
insert into InventoryStatus(StatusId,StatusDesc)values(-2,'已清仓')

--商品库存数据
--select * from view_product_storage;
update ProductInventory set TotalCount=190,MinCount=200,MaxCount=500,StatusId=1 where ProductId='6005004003001';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003001',190,200,500,1);--方便面
update ProductInventory set TotalCount=350,MinCount=200,MaxCount=500,StatusId=1 where ProductId='6005004003002';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003002',350,200,500,1);--方便面
update ProductInventory set TotalCount=230,MinCount=200,MaxCount=500,StatusId=1 where ProductId='6005004003003';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003003',230,200,500,1);--方便面
update ProductInventory set TotalCount=300,MinCount=200,MaxCount=400,StatusId=1 where ProductId='6005004003004';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003004',300,200,400,1);--方便面
update ProductInventory set TotalCount=190,MinCount=100,MaxCount=300,StatusId=1 where ProductId='6005004003005';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003005',190,100,300,1);--方便面
update ProductInventory set TotalCount=1000,MinCount=200,MaxCount=500,StatusId=2 where ProductId='6005004003006';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003006',1000,200,500,1);--啤酒
update ProductInventory set TotalCount=1000,MinCount=200,MaxCount=300,StatusId=2 where ProductId='6005004003007';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003007',1000,200,300,1);--啤酒
update ProductInventory set TotalCount=180,MinCount=200,MaxCount=300,StatusId=-1 where ProductId='6005004003008';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003008',180,200,300,1);--饮料
update ProductInventory set TotalCount=210,MinCount=200,MaxCount=300,StatusId=1 where ProductId='6005004003009';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003009',210,200,300,1);--饮料
update ProductInventory set TotalCount=150,MinCount=100,MaxCount=200,StatusId=1 where ProductId='6005004003010';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003010',150,100,200,1);--饮料
update ProductInventory set TotalCount=150,MinCount=100,MaxCount=200,StatusId=1 where ProductId='6005004003011';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003011',150,100,200,1);--饮料
update ProductInventory set TotalCount=200,MinCount=100,MaxCount=150,StatusId=2 where ProductId='6005004003012';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003012',200,100,150,2);--盒
update ProductInventory set TotalCount=80,MinCount=100,MaxCount=150,StatusId=-1 where ProductId='6005004003013';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003013',80,100,150,-1);--盒
update ProductInventory set TotalCount=50,MinCount=100,MaxCount=150,StatusId=-1 where ProductId='6005004003014';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003014',50,100,150,-1);--盒
update ProductInventory set TotalCount=180,MinCount=100,MaxCount=200,StatusId=1 where ProductId='6005004003015';
insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003015',180,100,200,1);--袋
update ProductInventory set TotalCount=160,MinCount=100,MaxCount=200,StatusId=1 where ProductId='6005004003016';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003016',160,100,200,1);--袋
update ProductInventory set TotalCount=1000,MinCount=100,MaxCount=200,StatusId=2 where ProductId='6005004003017';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003017',1000,100,200,2);--袋
update ProductInventory set TotalCount=230,MinCount=100,MaxCount=200,StatusId=2 where ProductId='6005004003018';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003018',230,100,200,2);--桶
update ProductInventory set TotalCount=150,MinCount=100,MaxCount=200,StatusId=1 where ProductId='6005004003019';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003019',150,100,200,1);--条
update ProductInventory set TotalCount=120,MinCount=100,MaxCount=200,StatusId=1 where ProductId='6005004003020';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003020',120,100,200,1);--桶
update ProductInventory set TotalCount=30,MinCount=10,MaxCount=100,StatusId=1 where ProductId='6005004003021';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003021',30,10,100,1);--条
update ProductInventory set TotalCount=30,MinCount=10,MaxCount=100,StatusId=1 where ProductId='6005004003022';
--insert into ProductInventory(ProductId,TotalCount,MinCount,MaxCount,StatusId) values('6005004003022',30,10,100,1);--条
```





Global.asax

```asp
<%@ Application Language="C#" %>

<script runat="server">

    void Application_Start(object sender, EventArgs e)
    {
        string sLogFile = AppDomain.CurrentDomain.BaseDirectory + "VisitedLog.txt";//日志文件的路径
        // 在应用程序启动时运行的代码
        if (!System.IO.File.Exists(sLogFile))
        {
            System.IO.FileStream fsnew = System.IO.File.Create(sLogFile);
            fsnew.Close();
        }
        string[] lines = System.IO.File.ReadAllLines(sLogFile);//读取并得到日志文件的行数
        long iTotalCount = 0;//设置初始访问人数为0
        int iOnline = 0;//设置初始在线人数为0
        if (lines != null && lines.Length > 0)
        {
            Int64.TryParse(lines[lines.Length - 1].ToString(), out iTotalCount);
        }
        Application.Lock();
        Application["TotalCount"] = iTotalCount;
        Application["Online"] = iOnline;
        Application.UnLock();
    }

    void Application_End(object sender, EventArgs e)
    {
        //  在应用程序关闭时运行的代码

    }

    void Application_Error(object sender, EventArgs e)
    {
        // 在出现未处理的错误时运行的代码

    }

    void Session_Start(object sender, EventArgs e)
    {
        // 在新会话启动时运行的代码
        try
        {
            Application.Lock();
            Application["Online"] = (int)Application["Online"] + 1;
            Application.UnLock();
            string sLogFile = AppDomain.CurrentDomain.BaseDirectory + "VisitedLog.txt";//日志文件的路径
            System.IO.StreamWriter file = new System.IO.StreamWriter(sLogFile,false);
            Application.Lock();
            long tot = (long)Application["TotalCount"] + 1;
            file.Write(tot.ToString().Trim());
            Application["TotalCount"] = tot;
            Application.UnLock();
            file.Close();
            file.Dispose();
        }
        catch(Exception es)
        {

        }


    }

    void Session_End(object sender, EventArgs e)
    {
        // 在会话结束时运行的代码。 
        // 注意: 只有在 Web.config 文件中的 sessionstate 模式设置为
        // InProc 时，才会引发 Session_End 事件。如果会话模式设置为 StateServer
        // 或 SQLServer，则不引发该事件。
            Application.Lock();
            Application["Online"] = (int)Application["Online"] - 1;
            Application.UnLock();
    }

</script>

```





StyleSheetSupermarket.css

```css
body { /*简单选择器*/
    background-color: lightskyblue;
    font-family: KaiTi,serif;
    font-size: 1.2em;
    text-align: center;
}

p {
    font-family: FangSong;
}

h1 {
    background-color: lightgreen;
}

#red {
    color: red;
}
/*id选择器*/
p.gushi {
    font-family: FangSong,serif;
    font-size: 20px;
    font-weight: bold;
    color: Crimson;
    background-color: Tan;
    word-spacing: 1px;
    line-height: 1.5em;
    text-indent: 2em;
    text-align: left;
}

p.submit {
    text-align: right;
    font-size: 15px;
    font-family: SimSun;
    font-weight: bold;
}

p.submit2 {
    text-align: left;
    font-size: 15px;
    font-family: SimSun;
    font-weight: bold;
}

.regText { /*类选择器，用于文本*/
    font-size: 1.1em;
    font-family: KaiTi;
    text-align: left;
    background-color: cornflowerblue;
}

.login {
    background-color: lightpink;
    width: 250px;
    margin: 0 auto;
}

.login2 {
    background-color: lightpink;
    width: 350px;
    margin: 0 auto;
}

.wordText { /*类选择器*/
    color: blue;
}

.pic1 {
    width: 8em;
    position: absolute;
    left: 10px;
    top: 450px;
    z-index: 40;
    background-color: yellow;
}

.pic2 {
    width: 8em;
    position: absolute;
    left: 150px;
    top: 550px;
    background-color: pink;
    z-index: 30;
}

.pic3 {
    width: 8em;
    position: absolute;
    left: 100px;
    top: 600px;
    background-color: green;
    z-index: 20;
}

.pic4 {
    width: 8em;
    position: absolute;
    left: 220px;
    top: 630px;
    background-color: cyan;
    z-index: 10;
}

.salesPersonInf {
    text-align: right;
    font-size: 0.8em;
    font-family: 'Microsoft YaHei';
    color: sienna;
}

table {
    margin: 0 auto;
    border-collapse: collapse;
    align-content: center;
    background-color: darksalmon;
}

table, td, th {
    border: 1px solid black;
}

th {
    background-color: darkorange;
}

p.showList {
    background-color: khaki;
    border-style: outset;
    width: 500px;
    margin: 0 auto;
    text-align: center;
}

.showMessage {
    background-color: antiquewhite;
    color: orangered;
    font-family: 'Microsoft YaHei';
    font-size: 0.7em;
}

p.showMessage {
    background-color: antiquewhite;
    color: orangered;
    font-family: 'Microsoft YaHei';
    font-size: 0.7em;
    width: 542px;
    margin-left: 493px;
}

```



JavaScriptCashCheck.js

```javascript
//JavaScriptCashCheck.js
function chkCashierName() {
    var name = document.getElementById("cashierName");
    return name.value.Length > 0;
}
function chkCashierPwd() {
    var pwd = document.getElementById("cashierPassword");
    return pwd.value.Length > 5;
}

function clickName() {
    alert('Please input your name');
    var dom = document.getElementById("cashierName");
    dom.style.backgroundColor = "yellow";
}
//DOM1第2种方式
//document.getElementById("cashierName").onmouseover = function () { this.style.backgroundColor = 'red'; }

//DOM2事件注册
//var ddom = document.getElementById("cashierPassword");
//ddom.addEventListener("change", chkCashierPwd, false);
```



JavaScriptCheck.js

```javascript
//JavaScriptCheck.js

function chkPhoneNum() {
    var phone = document.getElementById("custLoginPhoneNum");
    var res = /^1[3|4|5|7|8][0-9]-\d{4}-\d{4}$/.test(phone.value);
    if (res) {
        return true;
    }
    else {
        alert('手机号码格式必须为ddd-dddd-dddd，并且不能是空号！');
        phone.value = "";
        return false;
    }
}
```



JavaScriptPicture.js

```javascript
//JavaScriptPicture.js
var oldId = "id_1";
function toTop(NewId) {
	if(NewId!=oldId) {
		var newTp = document.getElementById(NewId).style;
		var oldTp = document.getElementById(oldId).style;
		oldTp.zIndex = 0;
		newTp.zIndex = 40;
		oldId = NewId;
	}
}
var dom, finalx = 0, finaly = 0, tag = 0;

function moveText(x, y) {
    if (tag % 100 == 0) {
        dom.color = "blue";
    }
    else if (tag % 100 == 50) {
        dom.color = "red";
    }
    tag = tag + 1;
    if (x != finalx) {
        if (x > finalx) --x;
        else if (x < finalx) ++x;
    }
    if (y != finaly) {
        if (y > finaly) --y;
        else if (y < finaly) ++y;
    }
    dom.left = x + "px";
    dom.top = y + "px";
    if ((x != finalx) || (y != finaly)) {
        setTimeout("moveText(" + x + "," + y + ")", 1);
    }
    else {
        if (finalx == 1300) finalx = 800;
        else finalx = 1300;
        setTimeout("moveText(" + x + "," + y + ")", 3);
    }
}

function initText() {
    dom = document.getElementById("pText").style;
    var xv = dom.left;
    var yv = dom.top;
    var x = xv.match(/\d+/);
    var y = yv.match(/\d+/);
    finalx = 1300;
    finaly = 600;
    moveText(x, y);
}

```



PhoneVerification.cs

```c#
//PhoneVerification.cs
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

/// <summary>
/// PhoneVerification 的摘要说明
/// </summary>
public class PhoneVerification
{
    static public string VerificationCode(string mobile)
    {
        if (IsHandset(mobile))
        {
            string code = new Random().Next(111111, 999999).ToString();
            string content = "[海之星超市]：本次操作的验证码为:" + code + " 切勿泄漏此验证码信息给他人，如非本人操作，请忽略此条信息。";
            // bool ret = SendFast(mobile, content);
            bool ret = true;
            if (ret)
            {
                return code;
            }
            else
            {
                return "发送失败";
            }
        }
        else
        {
            return "手机号码格式不正确";
        }
    }
    static public bool IsHandset(string str)
    {
        return System.Text.RegularExpressions.Regex.IsMatch(str, @"^1[3|4|5|7|8][0-9]\d{8}$"); //^表示从头开始匹配，$匹配\n或\r
    }
}
```



Products.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

/// <summary>
/// Products 的摘要说明
/// </summary>
public class Products
{
    public Products()
    {
        
    }
    public string ProductId   //商品编号
    { get; set; }
    public string ProductName //商品名称
    { get; set; }
    public decimal UnitPrice //商品单价
    { get; set; }
    public string Unit //计量单位
    { get; set; }
    public int Discount //折扣
    { get; set; }
    public int CategoryId //商品分类编号
    { get; set; }
    public int TotalCount //库存量
    { get; set; }
    public int MinCount //最小库存
    { get; set; }
    public int MaxCount //最大库存
    { get; set; }
}
```



SalesListDetail.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

/// <summary>
/// SalesListDetail 的摘要说明
/// </summary>
public class SalesListDetail
{
    public string ProductId //商品Id
    { get; set; }
    public string ProductName //商品名称
    { get; set; }
    public decimal UnitPrice //商品单价
    { get; set; }
    public decimal Discount //商品折扣，数据库中设置为整数
    { get; set; }
    public int Quantity //商品数量
    { get; set; }
    public decimal SubTotalMoney //金额小计
    { get; set; }
    public SalesListDetail() //构造函数
    {
        //
        // TODO: 在此处添加构造函数逻辑
        //
    }
    public SalesListDetail(string pid,string pName,decimal unitp,decimal discnt,int cnt,bool isMember)
    {
        this.ProductId = pid;
        this.ProductName = pName;
        this.UnitPrice = unitp;
        this.Discount = discnt;
        this.Quantity = cnt;
        this.SubTotalMoney = this.UnitPrice * this.Quantity * discnt / 10;
        if(isMember==true)
        {
            this.SubTotalMoney = this.SubTotalMoney*0.95m;
        }
    }
}
```



Web.config

```xml
<?xml version="1.0" encoding="utf-8"?>

<!--
  有关如何配置 ASP.NET 应用程序的详细信息，请访问
  https://go.microsoft.com/fwlink/?LinkId=169433
-->

<configuration>
  <appSettings>
    <add key="ValidationSettings:UnobtrusiveValidationMode" value="None" />
  </appSettings>
    <system.web>
      <compilation debug="true" targetFramework="4.6.1"/>
      <httpRuntime targetFramework="4.6.1"/>
      <!--<sessionState mode="InProc" cookieless="true" timeout="20" />-->
    </system.web>
    <system.codedom>
        <compilers>
            <compiler language="c#;cs;csharp" extension=".cs"
                type="Microsoft.CodeDom.Providers.DotNetCompilerPlatform.CSharpCodeProvider, Microsoft.CodeDom.Providers.DotNetCompilerPlatform, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
                warningLevel="4" compilerOptions="/langversion:default /nowarn:1659;1699;1701"/>
            <compiler language="vb;vbs;visualbasic;vbscript" extension=".vb"
                type="Microsoft.CodeDom.Providers.DotNetCompilerPlatform.VBCodeProvider, Microsoft.CodeDom.Providers.DotNetCompilerPlatform, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
                warningLevel="4" compilerOptions="/langversion:default /nowarn:41008 /define:_MYTYPE=\&quot;Web\&quot; /optionInfer+"/>
        </compilers>
    </system.codedom>
  <system.webServer>
    <defaultDocument>
      <files>
        <clear/>
        <add value="index.aspx"></add>
      </files>
    </defaultDocument>
  </system.webServer>
  
</configuration>

```



index.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="index.aspx.cs" Inherits="index" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市首页</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
    <script type="text/javascript" src="JavaScriptPicture.js"></script>
</head>
<body onload="initText()">
    <h1>欢迎来到海之星超市</h1>
    <p class="submit">如果您是超市管理员，请<a href="login.aspx">登录</a></p>
    <p class="submit">如果您是顾客，请<a href="custRegister.aspx">登录或注册</a></p>
    <p class="submit">如果您是收银员，请点击<a href="cashierLogin.aspx">登录</a>
    <p class="gushi">海之星超市是一家新兴的中小型超市。目前只有一家分店，但是日后会发展为连锁店。商店主要售卖的货物为食品，日用品。我们定价合理，物美价廉。
        "海之星"这个店名来源于"海洋之星"。
海洋之星，是蒙古帝国宫廷内四块巨型宝石之一，相传用于占卜与观天，出处不详，但来源说法之一是“长子西征”时从某斯拉夫小国掠夺而来。宝石质量通体碧蓝，大小“与玺相若”，产地传为列坦（今巴基斯坦西部诺贡迪地区）。据说蒙古帝国被朱元璋驱赶至长城以北后，在蒙古贵族迁徙过程中遗失，下落不详。有人自称曾在二战德军攻占基辅时在苏维埃国家银行的地下金库中见过海洋之星，但未得到证实。而电影泰坦尼克号中的“海洋之心”是以现实中噩运之钻“希望”为原型的。
    </p>
    <p class="regText">&nbsp;&nbsp;&nbsp;&nbsp;海之星超市
    <span class="wordText";
	      onmouseover="this.style.color='red';this.style.fontStyle='italic';this.style.fontSize='2em'"; 
	      onmouseout = "this.style.color='blue';this.style.fontStyle='normal';this.style.fontSize='1.1em';";
    >宽敞、明亮、温馨</span>，希望给周围小区的居民提供方便，简单的生活。希望给异地的游子和学生提供
    <span class="wordText";
          onmouseover="this.style.color='pink';this.style.fontStyle='oblique';this.style.fontFamily='LiSu';this.style.fontSize='2.5em'";
	      onmouseout = "this.style.color='blue';this.style.fontStyle='normal';this.style.fontSize='1.1em';";
    >宾至如归</span>的感觉。商店的老板是一位成功的企业家。他回到家乡开店，就是为了给乡亲们带来便捷。
    <span class="wordText"; 
          onmouseover="this.style.color='green';this.style.fontStyle='normal';this.style.fontFamily='YouYuan';this.style.fontSize='3em'";
	      onmouseout = "this.style.color='blue';this.style.fontStyle='normal';this.style.fontSize='1.1em';";>注册会员可享受95折优惠！</span>
        每消费10元可以获得1个积分。积分可以参与以后的活动。还在等什么呢？心动不如行动！
    </p>
    <p class="pic1" id = "id_1" onclick="toTop('id_1')"><img alt="shop picture1" src="image/shop1.png" width="500px" height="300px"/></p>
	<p class="pic2" id = "id_2" onclick="toTop('id_2')"><img alt="shop picture2" src="image/shop2.png" width="500px" height="300px"/></p>
	<p class="pic3" id = "id_3" onclick="toTop('id_3')"><img alt="shop picture3" src="image/shop3.png" width="500px" height="300px"/></p>
	<p class="pic4" id = "id_4" onclick="toTop('id_4')"><img alt="shop picture4" src="image/shop4.png" width="500px" height="300px"/></p>

    <p id="pText" style="position:absolute;top:600px;left:800px;font-size:1.2em;font-family:LiSu">海之星超市欢迎您</p>
    <form id="form1" runat="server">
        <div>
        </div>
    </form>
</body>
</html>

```

index.aspx.cs

```C#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class index : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        
    }
}
```



AdminManage.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="AdminManage.aspx.cs" Inherits="AdminManage" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-管理员权限管理</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h1>海之星超市-管理员权限管理</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
    <a href="show.aspx">返回管理员功能目录界面</a><br /><br />
    <form id="form1" runat="server">
        <div style="background-color:indianred; width: 530px; margin:0 auto;">
                添加普通管理员:<br />
            <label>管理员姓名:</label><asp:TextBox ID="TextBox_AdminName" runat="server"></asp:TextBox><br />

            <label>管理员密码:</label><asp:TextBox ID="TextBox_AdminPwd" runat="server"></asp:TextBox><br />
            <asp:Button ID="Button_Add" runat="server" Text="添加" OnClick="Button_Add_Click" />&nbsp;&nbsp;
            <asp:Button ID="Button_Reset" runat="server" Text="清空" OnClick="Button_Reset_Click" />
            <p id="showInsert" name="showInsert" class="showMessage" runat="server" style="margin:0 auto;" ></p>
        </div>
            
        <br /><br />
        <div>
            <asp:Button ID="Button_ShowAllAdmin" runat="server" Text="查询所有普通管理员" OnClick="Button_ShowAllAdmin_Click" />
            <asp:Button ID="Button_Clear" runat="server" Text="清除" OnClick="Button_Clear_Click" />
            <p id="showQuery" name="showQuery" class="showMessage" runat="server"></p>
        </div>

    </form>
</body>
</html>

```



AdminManage.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class AdminManage : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
        AdminInf.InnerHtml = htmlstr;
    }

    protected void Button_Reset_Click(object sender, EventArgs e)
    {
        TextBox_AdminName.Text = "";
        TextBox_AdminPwd.Text = "";
        showInsert.InnerHtml = "";
    }

    protected void Button_Add_Click(object sender, EventArgs e)
    {
        string AdminName = TextBox_AdminName.Text;
        string LoginPwd = TextBox_AdminPwd.Text;
        if(AdminName==""||LoginPwd=="")
        {
            showInsert.InnerHtml = "管理员姓名和密码都不能为空！";
            return;
        }
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }

            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            string str_insert = "insert into SysAdmins(LoginPwd,AdminName,AdminStatus,RoleId) values('{0}','{1}',1,2);";
            str_insert = string.Format(str_insert, LoginPwd, AdminName);
            command.CommandText = str_insert;
            int f = command.ExecuteNonQuery();
            if (f != 0)
            {
                showInsert.InnerHtml = "普通管理员[" + AdminName + "],密码[" + LoginPwd + "]添加成功！";
                TextBox_AdminName.Text = "";
                TextBox_AdminPwd.Text = "";
            }
            else
            {
                showInsert.InnerHtml = "普通管理员[" + AdminName + "],密码[" + LoginPwd + "]添加失败！";
            }
            conn.Close();
        }
        catch (Exception es)
        {
            showInsert.InnerHtml = "普通管理员[" + AdminName + "],密码[" + LoginPwd  + "]添加过程中出错了。错误信息如下:\n" + es.Message;
        }
    }

    protected void Button_ShowAllAdmin_Click(object sender, EventArgs e)
    {
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            command.CommandText = "select * from SysAdmins where RoleId=2";
            string HTML = "<table><caption>" + "普通管理员表" + "</caption><tr><th>管理员编号</th><th>管理员姓名</th><th>管理员密码</th><th>管理员状态</th><th>操作</th></tr>";
            var reader = command.ExecuteReader();
            if (reader.HasRows)
            {
                while (reader.Read())
                {
                    string LoginId = reader.GetInt32(0).ToString();
                    string AdminName = reader["AdminName"].ToString();
                    string LoginPwd = reader["LoginPwd"].ToString();
                    bool st = reader.GetBoolean(3);
                    int stt = st ? 1 : 0;
                    string AdminStatus = st ? "启用" : "禁用";
                    string LinkStr = "<a href=\"AdminModify.aspx?LoginId=" + LoginId + "&AdminName=" + AdminName + "&LoginPwd=" + LoginPwd + "&AdminStatus=" + stt.ToString() + "\">去修改<a>";
                    HTML += "<tr><td>" + LoginId + "</td><td>" + AdminName + "</td><td>" + LoginPwd + "</td><td>" + AdminStatus +"</td><td>"+ LinkStr+ "</td></tr>";
                }
            }
            HTML += "</table>";
            showQuery.InnerHtml = HTML;
            reader.Close();
            conn.Close();
        }
        catch (Exception es)
        {
            showQuery.InnerHtml = "出错了！错误信息如下：\n" + es.Message;
        }
    }

    protected void Button_Clear_Click(object sender, EventArgs e)
    {
        showQuery.InnerHtml = "";
    }
}
```



AdminModify.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="AdminModify.aspx.cs" Inherits="AdminModify" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-管理员信息修改界面</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h1>海之星超市-管理员信息修改界面</h1>
     <p id="AdminInf" class="salesPersonInf" runat="server"></p>
     <a href="AdminManage.aspx">返回权限管理界面</a><br /><br />
    <form id="form1" runat="server">
        <div>
            <label>管理员编号:</label><asp:TextBox ID="TextBox_AdminId" runat="server" ReadOnly="true"></asp:TextBox><br />
            <label>管理员姓名:</label><asp:TextBox ID="TextBox_AdminName" runat="server" ReadOnly="true"></asp:TextBox><br />
            <label>管理员密码:</label><asp:TextBox ID="TextBox_AdminPwd" runat="server"></asp:TextBox><br />
            <label>管理员状态:</label><asp:DropDownList ID="DropDownList_Status" runat="server" Width="158px"></asp:DropDownList><br />
            <asp:Button ID="Button_Submit" runat="server" Text="确认修改" OnClick="Button_Submit_Click" />
            <asp:Button ID="Button_Reset" runat="server" Text="重置" OnClick="Button_Reset_Click" />
            <p id="showResult" name="showResult" class="showMessage" runat="server"></p>
        </div>
    </form>
</body>
</html>

```



AdminModify.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class AdminModify : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if(!IsPostBack)
        {
            string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
            AdminInf.InnerHtml = htmlstr;
            TextBox_AdminId.Text = Request.QueryString["LoginId"];
            TextBox_AdminName.Text = Request.QueryString["AdminName"];
            TextBox_AdminPwd.Text = Request.QueryString["LoginPwd"];
            DropDownList_Status.Items.Add("禁用");
            DropDownList_Status.Items.Add("启用");
            DropDownList_Status.SelectedIndex = Convert.ToInt32(Request.QueryString["AdminStatus"]);
        }
    }

    protected void Button_Reset_Click(object sender, EventArgs e)
    {
        showResult.InnerHtml = "";
        TextBox_AdminPwd.Text = Request.QueryString["LoginPwd"];
        DropDownList_Status.SelectedIndex = Convert.ToInt32(Request.QueryString["AdminStatus"]);
    }

    protected void Button_Submit_Click(object sender, EventArgs e)
    {
        string AdminName = Request.QueryString["AdminName"];
        string LoginId = Request.QueryString["LoginId"];
        string PrePwd = Request.QueryString["LoginPwd"];
        string PreSt = Request.QueryString["AdminStatus"];
        string Pwd = TextBox_AdminPwd.Text;
        string State = DropDownList_Status.SelectedIndex.ToString();
        if(PrePwd==Pwd && PreSt==State)
        {
            showResult.InnerHtml = "密码和状态都没有更改，不需要更新！";
            return;
        }
        if(Pwd=="")
        {
            showResult.InnerHtml = "密码不能为空！";
            return;
        }
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }

            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            string str_update = "update SysAdmins set LoginPwd='" + Pwd + "',AdminStatus="+State+ " where LoginId=" + LoginId + ";";
            command.CommandText = str_update;
            int f = command.ExecuteNonQuery();
            if (f != 0)
            {
                showResult.InnerHtml = "编号为:" + LoginId + "姓名为:" + AdminName + "的管理员信息更改成功！"+"现在密码为:["+Pwd+"],状态为:"+((State=="1")?"启用":"禁用");
                TextBox_AdminId.Text = "";
                TextBox_AdminName.Text = "";
            }
            else
            {
                showResult.InnerHtml = "编号为:" + LoginId + "姓名为:" + AdminName + "的管理员信息更改失败！";

            }
            conn.Close();
        }
        catch (Exception es)
        {
            showResult.InnerHtml = "编号为:" + LoginId + "姓名为:" + AdminName + "的管理员信息更改过程中出错了！信息如下:\n" + es.Message;
        }
    }
}
```



CashierDelete.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="CashierDelete.aspx.cs" Inherits="CashierDelete" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-收银员删除页面</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h1>海之星超市-收银员删除页面</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
    <form id="form1" runat="server">
        <a href="CashierManage.aspx">点击返回收银员管理页面</a>><br /><br />
        <div>
            收银员编号:<asp:TextBox ID="TextBox_CashierID" runat="server" ReadOnly="true"></asp:TextBox><br />
            收银员姓名:<asp:TextBox ID="TextBox_CashierName" runat="server" ReadOnly="true"></asp:TextBox><br />
            <asp:Button ID="Button_Delete" runat="server" Text="确认删除" OnClick="Button_Delete_Click" />

            <p runat="server" id="showResult" name="showResult" class="showMessage"> </p>
        </div>
    </form>
</body>
</html>

```



CashierDelete.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class CashierDelete : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if(!IsPostBack)
        {
            string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
            AdminInf.InnerHtml = htmlstr;
            TextBox_CashierID.Text = Request.QueryString["SalesPersonId"];
            TextBox_CashierName.Text = Request.QueryString["SPName"];
        }
    }

    protected void Button_Delete_Click(object sender, EventArgs e)
    {
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }

            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            string str_insert = "delete from SalesPerson where SalesPersonId='" + Request.QueryString["SalesPersonId"].ToString() + "';";
            command.CommandText = str_insert;
            int f = command.ExecuteNonQuery();
            if (f != 0)
            {
                showResult.InnerHtml = "编号为:" + Request.QueryString["SalesPersonId"] + "姓名为:" + Request.QueryString["SPName"] + "的收银员删除成功！";
                TextBox_CashierID.Text = "";
                TextBox_CashierName.Text = "";
            }
            else
            {
                showResult.InnerHtml = "编号为:" + Request.QueryString["SalesPersonId"] + "姓名为:" + Request.QueryString["SPName"] + "的收银员删除失败！";

            }
            conn.Close();
        }
        catch (Exception es)
        {
            showResult.InnerHtml = "编号为:" + Request.QueryString["SalesPersonId"] + "姓名为:" + Request.QueryString["SPName"] + "的收银员删除过程中出错了!信息如下:\n"+es.Message;

        }
    }
}
```



cashierLogin.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="cashierLogin.aspx.cs" Inherits="cashierLogin" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-收银员登录</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
    <script type="text/javascript" src="JavaScriptCashCheck.js"></script>
</head>
<body>
    <h2>海之星超市</h2>
    <form id="form1" runat="server" method="post" action="cashierLoginCheck.aspx">
        <div class="login">
            <p>收银员登录:</p>
            <label>
            姓名:<input type="text" name="cashierName" id="cashierName" /><br /></label>
            <label>
            密码:<input type="password" name="cashierPassword" id="cashierPassword" /><br /></label>
            <input type="submit" value="登录" />
         <input type="reset" value="取消" />
        </div>
    </form>
    <br />
    <a href="index.aspx">返回超市主页</a>
</body>
</html>

```



cashierLogin.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class cashierLogin : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {

    }
}
```



cashierLoginCheck.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="cashierLoginCheck.aspx.cs" Inherits="cashierLoginCheck" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>cashierLoginCheck</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <form id="form1" runat="server">
        <div>
        </div>
    </form>
</body>
</html>

```



cashierLoginCheck.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class cashierLoginCheck : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        string SPName = Request.Form["cashierName"];
        string LoginPwd = Request.Form["cashierPassword"];
        string SalesPersonId = "";
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }          
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            command.CommandText = "select * from  SalesPerson where SPName='" + SPName + "' and LoginPwd='" + LoginPwd + "'";
            var reader = command.ExecuteReader();
            if (!reader.HasRows)
            {
                Response.Write("用户名或密码错误！<a href=\"cashierLogin.aspx\">返回重试</a>");
            }
            else
            {
                while(reader.Read())
                {
                    SalesPersonId = reader.GetInt32(0).ToString();
                }
                Session["curSalesPersonId"] = SalesPersonId;
                Session["curSPName"] = SPName;
                Session["curSPLoginPwd"] = LoginPwd;
                Response.Redirect("cashierWork.aspx");
            }
            reader.Close();
            conn.Close();
           
        }
        catch (Exception es)
        {
            Response.Write("除了一些错误，信息如下：\n" + es.Message);
        }
    }
}
```



CashierManage.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="CashierManage.aspx.cs" Inherits="CashierManage" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-收银员管理</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h1>海之星超市-收银员管理</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
        <a href="show.aspx">点击返回管理员功能目录页面</a>><br /><br />
    <form id="form1" runat="server">
        <div>
            <p>添加收银员</p>
            <label>登录姓名:</label><asp:TextBox ID="TextBox_CashierName" runat="server"></asp:TextBox><br />
            <label>登录密码:</label><asp:TextBox ID="TextBox_Pwd" runat="server"></asp:TextBox><br />
            <label>确认密码:</label><asp:TextBox ID="TextBox_Pwdd" runat="server"></asp:TextBox><br />
            <asp:Button ID="Button_Submit" runat="server" Text="添加" OnClick="Button_Submit_Click" />&nbsp;&nbsp;
            <asp:Button ID="Button_Reset" runat="server" Text="重置" OnClick="Button_Reset_Click" />
            <p runat="server" id="showRegisterMsg" name="showRegisterMsg" class="showMessage"> </p>
        </div>
        <div>
            <asp:Button ID="Button_Query" runat="server" Text="查看所有收银员" OnClick="Button_Query_Click" />
            <asp:Button ID="Button_Clear" runat="server" Text="清空" OnClick="Button_Clear_Click" /><br />
            <p runat="server" id="showCashier" name="showCashier"></p>
        </div>
    </form>
</body>
</html>

```



CashierManage.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class CashierManage : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
        AdminInf.InnerHtml = htmlstr;
    }

    protected void Button_Reset_Click(object sender, EventArgs e)
    {
        TextBox_CashierName.Text = "";
        TextBox_Pwd.Text = "";
        TextBox_Pwdd.Text = "";
        showRegisterMsg.InnerHtml = "";
    }

    protected void Button_Submit_Click(object sender, EventArgs e)
    {
        string SPName = TextBox_CashierName.Text;
        string LoginPwd = TextBox_Pwd.Text;
        string pwd2 = TextBox_Pwdd.Text;
        if(SPName==""||LoginPwd=="")
        {
            showRegisterMsg.InnerHtml = "姓名或密码都不能为空！";
            return;
        }
        if(LoginPwd.Length<6)
        {
            showRegisterMsg.InnerHtml = "密码长度不能小于6！";
            return;
        }
        if(LoginPwd!=pwd2)
        {
            showRegisterMsg.InnerHtml = "密码和确认密码不一致！";
            return;
        }
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }

            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            string str_insert = "insert into SalesPerson(SPName,LoginPwd) values('{0}','{1}');";
            str_insert = string.Format(str_insert, SPName, LoginPwd);
            command.CommandText = str_insert;
            int f = command.ExecuteNonQuery();
            if (f != 0)
            {
                showRegisterMsg.InnerHtml = "收银员[" + SPName + "],密码[" + LoginPwd + "]添加成功！";
            }
            else
            {
                showRegisterMsg.InnerHtml = "收银员[" + SPName + "],密码[" + LoginPwd + "]添加失败！";
            }
            conn.Close();
        }
        catch (Exception es)
        {
            showRegisterMsg.InnerHtml = "收银员[" + SPName + "],密码[" + LoginPwd + "]添加过程中出错了。错误信息如下:\n"+es.Message;
        }
    }

    protected void Button_Clear_Click(object sender, EventArgs e)
    {
        showCashier.InnerHtml = "";
    }

    protected void Button_Query_Click(object sender, EventArgs e)
    {
        string HTML = "<table><caption>收银员信息表</caption><tr><th>序号</th><th>收银员编号</th><th>收银员姓名</th><th>登录密码</th><th>操作</th></tr>";
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            command.CommandText = "select * from SalesPerson";
            var reader = command.ExecuteReader();
            if (reader.HasRows)
            {
                int cntt = 0;
                while (reader.Read())
                {
                    ++cntt;
                    string SalesPersonId = reader.GetInt32(0).ToString();
                    string SPName = reader["SPName"].ToString();
                    string LoginPwd = reader["LoginPwd"].ToString();
                    string LinkStrDelete = "<a href=\"CashierDelete.aspx?SalesPersonId=" + SalesPersonId + "&SPName=" + SPName + "\">去删除</a>";
                    string LinkStrModify = "<a href=\"CashierModify.aspx?SalesPersonId=" + SalesPersonId + "&SPName=" + SPName + "&LoginPwd="+ LoginPwd + "\">去修改</a>";
                    HTML += "<tr><td>" + cntt.ToString() + "</td><td>" + SalesPersonId + "</td><td>" + SPName + "</td><td>" + LoginPwd + "</td><td>" +
                        LinkStrDelete + "&nbsp;&nbsp;" + LinkStrModify + "</td></tr>";
                }
            }
            reader.Close();
            conn.Close();
        }
        catch (Exception es)
        {
            Response.Write("出错了！错误信息如下：\n" + es.Message);
        }
        HTML += "</table>";
        showCashier.InnerHtml = HTML;
    }
}
```



CashierModify.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="CashierModify.aspx.cs" Inherits="CashierModify" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-收银员信息更改页面</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h1>海之星超市-收银员信息更改页面</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
    <a href="CashierManage.aspx">点击返回收银员管理页面</a>><br /><br />
    <form id="form1" runat="server">
        <div>
             收银员编号:<asp:TextBox ID="TextBox_CashierID" runat="server" ReadOnly="true"></asp:TextBox><br />
            收银员姓名:<asp:TextBox ID="TextBox_CashierName" runat="server" ReadOnly="true"></asp:TextBox><br />
            收银员密码:<asp:TextBox ID="TextBox_Pwd" runat="server"></asp:TextBox><br />
            <asp:Button ID="Button_Submit" runat="server" Text="确认修改" OnClick="Button_Delete_Click" />
            <asp:Button ID="Button_Reset" runat="server" Text="还原" OnClick="Button_Reset_Click" /><br />
            <p runat="server" id="showResult" name="showResult" class="showMessage"> </p>
        </div>
    </form>
</body>
</html>

```



CashierModify.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class CashierModify : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if(!IsPostBack)
        {
            string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
            AdminInf.InnerHtml = htmlstr;
            TextBox_CashierID.Text = Request.QueryString["SalesPersonId"];
            TextBox_CashierName.Text = Request.QueryString["SPName"];
            TextBox_Pwd.Text = Request.QueryString["LoginPwd"];
        }   
    }

    protected void Button_Reset_Click(object sender, EventArgs e)
    {
        showResult.InnerHtml = "";
        TextBox_Pwd.Text = Request.QueryString["LoginPwd"];
    }

    protected void Button_Delete_Click(object sender, EventArgs e)
    {
        string PrePwd = Request.QueryString["LoginPwd"];
        string Pwd = TextBox_Pwd.Text;
        if(Pwd==PrePwd)
        {
            showResult.InnerHtml = "密码没有改变，不需要更新！";
            return;
        }
        if(Pwd=="")
        {
            showResult.InnerHtml = "请输入密码！";
            return;
        }
        if(Pwd.Length<6)
        {
            showResult.InnerHtml = "密码不能少于6位！";
            return;
        }
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }

            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            string str_insert = "update SalesPerson set LoginPwd='"+Pwd+"' where SalesPersonId='" + Request.QueryString["SalesPersonId"].ToString() + "';";
            command.CommandText = str_insert;
            int f = command.ExecuteNonQuery();
            if (f != 0)
            {
                showResult.InnerHtml = "编号为:" + Request.QueryString["SalesPersonId"] + "姓名为:" + Request.QueryString["SPName"] + "的收银员改密码成功！";
                TextBox_CashierID.Text = "";
                TextBox_CashierName.Text = "";
            }
            else
            {
                showResult.InnerHtml = "编号为:" + Request.QueryString["SalesPersonId"] + "姓名为:" + Request.QueryString["SPName"] + "的收银员改密码失败！";

            }
            conn.Close();
        }
        catch (Exception es)
        {
            showResult.InnerHtml = "编号为:" + Request.QueryString["SalesPersonId"] + "姓名为:" + Request.QueryString["SPName"] + "的收银员改密码过程中出错了!信息如下:\n" + es.Message;

        }

    }
}
```



cashierWork.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="cashierWork.aspx.cs" Inherits="cashierWork" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-收银系统</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
    <script type="text/javascript" src="JavaScriptCashierWork.js"></script>
</head>
<body>
    <h2>海之星超市-收银系统</h2>
    <form id="form1" runat="server">
        <p id="SPInf" class="salesPersonInf" runat="server"></p>
        <div>
            <asp:Button ID="id_startCash" runat="server" Text="开始收银" BackColor="#99FF66" OnClick="id_startCash_Click"  /><br />
            顾客会员号: <asp:DropDownList ID="DropDownList_MemId" runat="server"></asp:DropDownList>

            <p>
                商品id: <asp:DropDownList ID="DropDownList_ProductId" runat="server" AutoPostBack="true" OnSelectedIndexChanged="DropDownList_ProductId_SelectedIndexChanged"></asp:DropDownList>
                &nbsp;&nbsp;
                数量: 
                <asp:DropDownList ID="DropDownList_num" runat="server" AutoPostBack="true" Width="40px"> </asp:DropDownList>
                &nbsp;&nbsp;
                <asp:Button ID="Button_AddPro" runat="server" Text="添加" OnClick="Button_AddPro_Click1" /> 
            </p>
            <p>
                <asp:ListBox ID="ListBox1" runat="server" Width="496px" Height="200px"></asp:ListBox>

            </p>
        </div>
        <asp:Button ID="Button_DelItem" runat="server" OnClick="Button_DelItem_Click" Text="删除选中项" Width="89px" />
        &nbsp;&nbsp;
        <asp:Button ID="Button_Pay" runat="server"  Text="结算" OnClick="Button_Pay_Click" Width="70px" />
        &nbsp;&nbsp;累计￥<asp:TextBox ID="TextBox_Cur_TotMoney" runat="server"></asp:TextBox>
        <p id="showSolve" class="showList" runat="server"></p>
    </form>
</body>
</html>

```



cashierWork.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;
using System.Collections;

public partial class cashierWork : System.Web.UI.Page
{
    static Hashtable htProidToItem = new Hashtable();
    static Hashtable htProidToCnt = new Hashtable();
    static List<SalesListDetail> saleslist = new List<SalesListDetail>();
    protected void Page_Load(object sender, EventArgs e)
    {
        if(!IsPostBack)
        {
            TextBox_Cur_TotMoney.Text = "0";
        }
        //-------------------显示收银员姓名和ID
        string curSalesPersonId = Session["curSalesPersonId"].ToString().Trim();
        string curSPName = Session["curSPName"].ToString().Trim();
        string HTML = "收银员ID:" + curSalesPersonId + "&nbsp;收银员姓名:" + curSPName+"&nbsp;<a href=\"Logout.aspx?identity=Cashier\">注销</a>";
        SPInf.InnerHtml = HTML;
        //if (!IsPostBack)
        // {
        //--------------------------------------
        if (!IsPostBack)
        {
            for (int i = 1; i <= 10; ++i)
                DropDownList_num.Items.Add(new ListItem(i.ToString()));
            DropDownList_MemId.Items.Add(new ListItem("非会员"));
        }
        //--------------------------------------

        if(!IsPostBack)
        {
            //-----注销过期的会员------------------------------------------------------------
            try
            {
                //第一步，新建连接对象
                SqlConnection conn = new SqlConnection();
                //第二步，给连接对象指定参数（连接字符串）
                conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
                //第三步，开始建立连接
                if (conn.State != System.Data.ConnectionState.Open)
                {
                    conn.Open();
                }
                SqlCommand command = new SqlCommand();
                command.Connection = conn;
                command.CommandText = "delete from SMMembers where DATEDIFF(day,OpenTime,getDate())>365;";
                int f = command.ExecuteNonQuery();
                conn.Close();
            }
            catch (Exception es)
            {
                Response.Write("出现了一点儿错误，错误信息如下：\n" + es.Message);
            }
            //--------------------------------------
            try
                {
                    //第一步，新建连接对象
                    SqlConnection conn = new SqlConnection();
                    //第二步，给连接对象指定参数（连接字符串）
                    conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
                    //第三步，开始建立连接
                    if (conn.State != System.Data.ConnectionState.Open)
                    {
                        conn.Open();
                    }
                    SqlCommand command = new SqlCommand();
                    command.Connection = conn;
                    command.CommandText = "select * from view_product_storage";
                    var reader = command.ExecuteReader();
                    List<Products> productsList = new List<Products>();
                    if (reader.HasRows)
                    {
                        while (reader.Read())
                        {
                            Products pro = new Products();
                            pro.ProductId = reader["商品编号"].ToString().Trim();
                            pro.ProductName = reader["名称"].ToString().Trim();
                            pro.UnitPrice = reader.GetDecimal(2);
                            pro.Unit = reader["计量单位"].ToString().Trim();
                            pro.TotalCount = reader.GetInt32(4);
                            pro.Discount = reader.GetInt32(5);
                            productsList.Add(pro);
                            if(!htProidToItem.Contains(pro.ProductId))
                                htProidToItem.Add(pro.ProductId, pro);
                        }
                    }
                    reader.Close();
                    if(!IsPostBack) { 
                        foreach (Products pro in productsList)
                        {
                            DropDownList_ProductId.Items.Add(new ListItem(pro.ProductId));
                        }
                    }
                command.CommandText = "select MemberId from SMMembers where MemberStatus=1;";
                    var reader2 = command.ExecuteReader();
                if (!IsPostBack)
                {
                    if (reader2.HasRows)
                    {
                        while (reader2.Read())
                        {
                            string memberId = reader2.GetInt32(0).ToString().Trim();
                            DropDownList_MemId.Items.Add(new ListItem(memberId));
                        }
                    }
                }
                reader2.Close();

                conn.Close();
            }
            catch (Exception es)
            {
                Response.Write("出错了！错误信息如下：\n" + es.Message);
            }
        }

    }
   // }

    protected void id_startCash_Click(object sender, EventArgs e)
    {
        //Response.Write("开始收银！");
        DropDownList_ProductId.SelectedIndex = 0;
        DropDownList_MemId.SelectedIndex = 0;
        ListBox1.Items.Clear();
        htProidToCnt.Clear();
        saleslist.Clear();
        TextBox_Cur_TotMoney.Text = "0";
        showSolve.InnerHtml = "";
    }

    protected void Button_AddPro_Click1(object sender, EventArgs e) //添加商品
    {
        string pId = DropDownList_ProductId.Text; //商品id
        int proCnt = Convert.ToInt32(DropDownList_num.Text); //商品数量
        Products pro = new Products();
        pro = (Products)htProidToItem[pId];
        string pName = pro.ProductName;
        string pUnit = pro.Unit;
        string pUnitP = pro.UnitPrice.ToString();
        string pCnt = proCnt.ToString();
        if (!htProidToCnt.Contains(pId))
        {
            htProidToCnt.Add(pId, proCnt);
        }
        else
        {
            int preCnt = (int)htProidToCnt[pId];
            htProidToCnt.Remove(pId);
            htProidToCnt.Add(pId, preCnt + proCnt);
        }
  
        bool isMember = (DropDownList_MemId.SelectedIndex != 0);
        saleslist.Add(new SalesListDetail(pro.ProductId,pro.ProductName,pro.UnitPrice,pro.Discount,proCnt,isMember));
        //Response.Write("ListBox长度：" + ListBox1.Items.Count.ToString() + " salelist长度：" + saleslist.Count.ToString());
        decimal subtotmoney = pro.UnitPrice * pro.Discount/10m * proCnt;
        if (isMember) subtotmoney *= 0.95m;
        //Response.Write("subtotmony=" + subtotmoney.ToString() + " 单价:" + pro.UnitPrice.ToString() + " 折扣:" + pro.Discount.ToString() + " 个数:" + proCnt.ToString());
        decimal curTot = Convert.ToDecimal(TextBox_Cur_TotMoney.Text) + subtotmoney;
        TextBox_Cur_TotMoney.Text = curTot.ToString();
        string strProductInf = pId + "  " + pName + "  " + DropDownList_num.Text
           + pUnit + "  ￥" + pUnitP + "/" + pUnit+" "+pro.Discount+"折  ￥"+ subtotmoney.ToString();
        ListBox1.Items.Add(strProductInf);
        DropDownList_num.SelectedIndex = 0;
    }

    protected void DropDownList_ProductId_SelectedIndexChanged(object sender, EventArgs e)
    {
        DropDownList_num.SelectedIndex = 0;
    }

    protected void Button_DelItem_Click(object sender, EventArgs e) //删除一个选项
    {
        int[] arr = ListBox1.GetSelectedIndices();
        int len = arr.Length;
        for(int i=0;i<len;++i)
        {
            string strdel = ListBox1.Items[arr[i]].Text;
            ListBox1.Items.Remove(strdel);
            Response.Write(arr[i].ToString()+" "+strdel);
            SalesListDetail sld = new SalesListDetail();
            sld = saleslist[arr[i]];
            decimal curTot = Convert.ToDecimal(TextBox_Cur_TotMoney.Text) - sld.SubTotalMoney;
            TextBox_Cur_TotMoney.Text = curTot.ToString();
            saleslist.Remove(sld);
            string pid = sld.ProductId;
            if(htProidToCnt.Contains(pid))
            {
                int preCnt = (int)htProidToCnt[pid];
                htProidToCnt.Remove(pid);
                if(preCnt>sld.Quantity)
                {
                    htProidToCnt.Add(pid, preCnt - sld.Quantity);
                }       
            }
        }
    }


    protected void Button_Pay_Click(object sender, EventArgs e) //结算按钮
    {
        string inner = "";
       /* foreach(var tmp in htProidToCnt.Keys)
        {
            inner += tmp.ToString() + ":" + htProidToCnt[tmp].ToString() + "<br/>";
        }
        showSolve.InnerHtml = inner;
        */
        saleslist.Clear();
        foreach(var pid in htProidToCnt.Keys)
        {
            int cnt = (int)htProidToCnt[pid]; //个数
            Products pro = new Products();
            pro = (Products)htProidToItem[pid];
            bool isMember = (DropDownList_MemId.SelectedIndex != 0);
            saleslist.Add(new SalesListDetail(pro.ProductId,pro.ProductName,pro.UnitPrice,pro.Discount,cnt,isMember));
        }
        string memberId = "000000000";
        if (DropDownList_MemId.SelectedIndex != 0) memberId = DropDownList_MemId.Text.Trim();
        //订单流水号：日期+时间+收银员id+会员id
        string SerialNum = DateTime.Now.ToString("yyyy-MM-dd_HH:mm:ss") +"_" +Session["curSalesPersonId"].ToString().Trim() + "_" + memberId;
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }

            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            string sqlstr = "insert into SalesList(SerialNum,TotalMoney,RealReceive,ReturnMoney,SalesPersonId,SaleDate) values('{0}','{1}','{2}','{3}',{4},default);";
            sqlstr = string.Format(sqlstr, SerialNum, TextBox_Cur_TotMoney.Text, TextBox_Cur_TotMoney.Text, "0.00", Session["curSalesPersonId"].ToString().Trim());
            command.CommandText = sqlstr;
            string innerStr = "交易成功！<br/>交易流水号为:" + SerialNum + "<br/>小票如下:<br/>";
            innerStr += "<table>\n<tr><th>编号</th><th>商品</th><th>单价</th><th>折扣</th><th>个数</th><th>小计</th></tr>";
            int cntt = 0;
            int f = command.ExecuteNonQuery();
            if (f <= 0)
            {
                Response.Write("订单插入失败！");
            }
            else //插入流水明细
            {
                string sql = "insert into SalesListDetail(SerialNum, ProductId, ProductName, UnitPrice, Discount, Quantity, SubTotalMoney) values('{0}','{1}','{2}',{3},{4},{5},'{6}');";
                foreach (var dt in saleslist)
                {
                    string pid = dt.ProductId, pname = dt.ProductName, up = dt.UnitPrice.ToString(), disc = dt.Discount.ToString(), cnt = dt.Quantity.ToString(), tot = dt.SubTotalMoney.ToString();
                    string sqlStr = string.Format(sql, SerialNum, pid, pname, up, disc, cnt, tot);
                    command.CommandText = sqlStr;
                    int g = command.ExecuteNonQuery();
                    if (g <= 0)
                    {
                        Response.Write("插入小票明细失败");
                    }
                    cntt++;
                    innerStr += "<tr><td>" + cntt.ToString() + "</td><td>"+pname+"</td><td>" + up + "</td><td>" + disc + "</td><td>" + cnt + "</td><td>" + tot + "</td></tr>";
                }
                if (DropDownList_MemId.SelectedIndex != 0)
                {
                    int add = (int)(Convert.ToDecimal(TextBox_Cur_TotMoney.Text) / 20);
                    string sql2 = "update SMMembers set Points=Points+" + add.ToString() + " where MemberId=" + DropDownList_MemId.Text;
                    command.CommandText = sql2;
                    int h = command.ExecuteNonQuery();
                    if (h <= 0)
                    {
                        Response.Write("会员更新更新积分失败！");
                    }
                    command.ExecuteNonQuery();
                }
            }
            conn.Close();
            innerStr += "</table>\n";
            innerStr += "总计:￥" + TextBox_Cur_TotMoney.Text;
            showSolve.InnerHtml = innerStr;

        }
        catch (Exception es)
        {
            Response.Write("出现了一点儿错误，错误信息如下：\n" + es.Message);
        }
        
        DropDownList_MemId.SelectedIndex = 0;
        ListBox1.Items.Clear();
        htProidToCnt.Clear();
        saleslist.Clear();
        TextBox_Cur_TotMoney.Text = "0";
    }
}
```



custLogin.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="custLogin.aspx.cs" Inherits="custLogin" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-会员登录</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
    <script type="text/javascript" src="JavaScriptCheck.js"></script>
</head>
<body>
    <h2>海之星超市</h2>
    
    <form id="form1" runat="server" action="custLoginCheck.aspx">
        <div class="login2">
            <p>会员登录</p>
            <p>
                会员姓名：<input type="text" name="custLoginName" /> <br/>
                会员电话: <input type="text" name="custLoginPhoneNum" id="custLoginPhoneNum" value="ddd-dddd-dddd"onblur="chkPhoneNum()" /><br />
                <input type="submit" value="登录" />
                <input type="reset" value="取消" />
            </p>
        </div>
    </form>
    <br/>
    <a href="index.aspx">返回超市主页</a>
</body>
</html>

```



custLogin.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class custLogin : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {

    }
}
```



custLoginCheck.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="custLoginCheck.aspx.cs" Inherits="custLoginCheck" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
    <title>check</title>
</head>
<body>
    <form id="form1" runat="server">
        <div>
        </div>
    </form>
</body>
</html>

```



custLoginCheck.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class custLoginCheck : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        string MemberName = Request.Form["custLoginName"];
        string PhoneNumber = Request.Form["custLoginPhoneNum"];
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            command.CommandText = "select * from  SMMembers where MemberName='" + MemberName + "' and PhoneNumber='" + PhoneNumber + "'";
            var reader = command.ExecuteReader();
            if (!reader.HasRows)
            {
                Response.Write("用户名或密码错误！<a href=\"custLogin.aspx\">返回重试</a>");
            }
            else
            {
                Session["curMemberName"] = MemberName;
                Session["curPhoneNumber"] = PhoneNumber;
                string MemberId = "";
                string MemberAddress = "";
                string strOpenTime = "";
                DateTime OpenTime = DateTime.Now;
                string Points = "";
                while (reader.Read())
                {
                    MemberId = reader.GetInt32(0).ToString().Trim();
                    MemberAddress = reader["MemberAddress"].ToString().Trim();
                    OpenTime = reader.GetDateTime(5);
                    strOpenTime = OpenTime.ToString("D");
                    Points = reader.GetInt32(2).ToString();
                }
                DateTime LastTime = OpenTime.AddYears(1);
                Session["curLastTime"] = LastTime.ToString("D");
                Session["curMemberId"] = MemberId;
                Session["curMemberAddress"] = MemberAddress;
                Session["curOpenTime"] = strOpenTime;
                Session["curPoints"] = Points;
                Response.Redirect("showCustInf.aspx");
            }
            reader.Close();
            conn.Close();
        }
        catch (Exception es)
        {
            Response.Write("除了一些错误，信息如下：\n" + es.Message);
        }

    }
}
```



custRegister.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="custRegister.aspx.cs" Inherits="custRegister" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-会员注册</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body style="text-align:left; width: 1531px;">
    <h1 style="margin:0 auto;text-align:center;">海之星超市-会员注册</h1>
    <a href="index.aspx">返回超市主页</a>
    <form id="form1" runat="server" action="custRegisterCheck.aspx">
        <div style="background-color:antiquewhite;">
            <p>
                <label>姓名：</label>
                    <asp:TextBox ID="MemberName" runat="server"></asp:TextBox><br/>
                <label>电话：</label>
                <asp:TextBox ID="PhoneNumber" runat="server" ></asp:TextBox>
                <asp:RegularExpressionValidator ID="phoneValidator" ControlToValidate="PhoneNumber" 
                    Display="Static" runat="server" ErrorMessage="电话号码的格式必须为：ddd-dddd-dddd" 
                    ValidationExpression="\d{3}-\d{4}-\d{4}"></asp:RegularExpressionValidator><br />
                <label>住址：</label>
                <asp:TextBox ID="MemberAddress" runat="server"></asp:TextBox><br />
                <asp:Button runat="server" Text="注册" />
            </p>
            <p>你已经是会员了？<a href="custLogin.aspx">去登录</a></p>
        </div>
        <p id="ErrorMsg"></p>
    </form>
</body>
</html>

```



custRegister.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class custRegister : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {

    }
}
```



custRegisterCheck.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="custRegisterCheck.aspx.cs" Inherits="custRegisterCheck" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-会员注册结果</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h1>海之星超市-会员注册结果</h1>
    <form id="form1" runat="server">
        <div id="inf">
            
        </div>
    </form>
</body>
</html>

```



custRegisterCheck.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class custRegisterCheck : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        string MemberName = Request.Form["MemberName"];
        string PhoneNumber = Request.Form["PhoneNumber"];
        string MemberAddress = Request.Form["MemberAddress"];
        //Response.Write("<p>" + MemberName + "</p>");
        
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
 
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            command.CommandText = "select * from  SMMembers where PhoneNumber='" + PhoneNumber+"'";
            var reader = command.ExecuteReader();
            if (!reader.HasRows) //说明这个手机号没有被人注册过，可以注册
            {
                reader.Close();
                //insert into SMMembers(MemberName,Points,PhoneNumber,MemberAddress,OpenTime,MemberStatus) values('郭靖',default,'173-6299-2401','襄阳',default,default);
                string str_insert = "insert into SMMembers(MemberName,Points,PhoneNumber,MemberAddress,OpenTime,MemberStatus) values('{0}',default,'{1}','{2}',default,default);";
                str_insert = string.Format(str_insert, MemberName, PhoneNumber, MemberAddress);
                command.CommandText = str_insert;
                int f = command.ExecuteNonQuery();
                if(f!=0)
                {
                    string say = "恭喜您，" + MemberName + "成为海之星超市的会员！";
                    Response.Write("<script>alert('会员注册成功！')</script>");
                    Response.Write(say);
                    Response.Write("<a href=\"custLogin.aspx\">去登录</a><br/>");
                    //show一下会员信息

                }
                else
                {
                    Response.Write("<script>alert('注册失败！')</script>");
                }
                //Response.Write("用户名或密码错误！<a href=\"login.aspx\">返回重试</a>");
            }
            else
            {
                string msgg = "<p>手机号"+PhoneNumber + "已经被注册过了</p>";
                Response.Write(msgg);
                Response.Write("<a href=\"custRegister.aspx\">用其它手机号码重新注册</a><br/><a href=\"custLogin.aspx\">去登录</a><br/>");
                
            }
            conn.Close();
        }
        catch (Exception es)
        {
            Response.Write("出现了一点儿错误，错误信息如下：\n"+es.Message);
        }
        
    }
}
```



InventoryManage.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="InventoryManage.aspx.cs" Inherits="InventoryManage" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-库存管理</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h1>海之星超市-库存管理</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
    <a href="show.aspx">点击返回管理员功能目录页面</a><br /><br />
    <form id="form1" runat="server">
        <div>
            <asp:Button ID="Button_ShowAll" runat="server" Text="查询全部商品的库存" Width="160px" OnClick="Button_ShowAll_Click" />
            <p id="showInventory" runat="server"></p>
        </div>
    </form>
</body>
</html>

```



InventoryManage.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class InventoryManage : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
        AdminInf.InnerHtml = htmlstr;


    }

    protected void Button_ShowAll_Click(object sender, EventArgs e)
    {
        string HTML = "";
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
            HTML = "<table><tr><th>序号</th><th>商品编号</th><th>商品名称</th><th>库存总量</th><th>最小库存量</th><th>最大库存量</th><th>库存状态</th><th>操作</th></tr>";
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            command.CommandText = "select tb1.ProductId,ProductName,TotalCount,MinCount,MaxCount,UnitPrice,Discount,Unit from ProductInventory as tb1,Products as tb2 where tb1.ProductId=tb2.ProductId;";
            var reader = command.ExecuteReader();
            int cntt = 0;
            if (reader.HasRows)
            {
                while (reader.Read())
                {
                    cntt += 1;
                    string ProductId = reader["ProductId"].ToString();
                    string ProductName = reader["ProductName"].ToString();
                    int TotalCount = reader.GetInt32(2);
                    int MinCount = reader.GetInt32(3);
                    int MaxCount = reader.GetInt32(4);
                    string UnitPrice = reader.GetDecimal(5).ToString();
                    string Discount = reader.GetInt32(6).ToString();
                    string Unit = reader["Unit"].ToString();
                    string Status = "";
                    if(TotalCount<MinCount)
                    {
                        Status = "过少";
                    }
                    else if(TotalCount>MaxCount)
                    {
                        Status = "过多";
                    }
                    else
                    {
                        Status = "正常";
                    }
                    string Linkstr = "<a href=\"ProductModify.aspx?ProductId=" + ProductId + "&ProductName=" + ProductName + "&UnitPrice="
                        + UnitPrice + "&Discount=" + Discount +"&Unit="+Unit+ "\">修改价格</a>";
                    string Linkstr2 = "<a href=\"PurchaseManage.aspx?ProductId=" + ProductId + "&ProductName=" + ProductName+"&UnitPrice="+UnitPrice +"&Unit="+Unit+ "\">去进货</a>";
                    HTML += "<tr><td>" + cntt.ToString() + "</td><td>" + ProductId + "</td><td>" + ProductName + "</td><td>" + TotalCount.ToString() + "</td><td>" +
                        MinCount.ToString() + "</td><td>" + MaxCount.ToString() + "</td><td>" + Status + "</td><td>" + Linkstr+"&nbsp;&nbsp;"+Linkstr2 + "</td></tr>";
                }
            }
            HTML += "</table>";
            reader.Close();
            conn.Close();
        }
        catch (Exception es)
        {
            Response.Write("出错了！错误信息如下：\n" + es.Message);
        }
        showInventory.InnerHtml = HTML;
    }
}
```



login.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="login.aspx.cs" Inherits="login" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市管理员登录</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h2>海之星超市</h2>
    <form id="form1" runat="server" action="loginCheck.aspx" method="post">
        <div class="login">
        <p>管理员登录:</p>
        姓名:<input type="text" name="username" /><br />
        密码:<input type="password" name="userpassword" /><br />
        <input type="submit" value="登录" />
        <input type="reset" value="取消" />
        </div>
    </form>
    <br />
    <a href="index.aspx">返回超市主页</a>
</body>
</html>

```



login.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class login : System.Web.UI.Page
{ 
    /*
    public void Submit_Button_Click(object sender, EventArgs e)
    {
        if (username.Text == "xzc" && userpassword.Text == "123")
        {
            Response.Write("欢迎你" + username.Text);
        }
        else
        {
            Response.Write("用户名或者密码不正确");
        }
    }
    public void Reset_Button_Click(object sender, EventArgs e)
    {
        username.Text = "";
        userpassword.Text = "";
    }
    */
}
```



loginCheck.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="loginCheck.aspx.cs" Inherits="loginCheck" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
    <title>check管理员</title>
</head>
<body>
    <form id="form1" runat="server">
        <div>
        </div>
    </form>
</body>
</html>

```



loginCheck.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class loginCheck : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        string username = Request.Form["username"];
        string pwd = Request.Form["userpassword"];
        try { 
        //第一步，新建连接对象
        SqlConnection conn = new SqlConnection();
        //第二步，给连接对象指定参数（连接字符串）
        conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            command.CommandText = "select * from  SysAdmins where AdminName='" +username+ "' and LoginPwd='"+pwd+"'";
            var reader = command.ExecuteReader();
            string LoginId = "";
            bool AdminStatus = true;
            string RoleId = "";

            //Response.Write("alert(reader)");
            if (!reader.HasRows)
            {
                Response.Write("用户名或密码错误！<a href=\"login.aspx\">返回重试</a>");
            }
            else
            {
                while (reader.Read())
                {
                    LoginId = reader.GetInt32(0).ToString();
                    AdminStatus = reader.GetBoolean(3);
                    RoleId = reader.GetInt32(4).ToString().Trim();
                    //Response.Write("LoginId" + LoginId + " 状态:"+AdminStatus.ToString()+" RoleId:"+RoleId);
                    
                }
                if(!AdminStatus)
                {
                    Response.Write("管理员"+username+"暂未启用。请联系经理授权或者使用其它管理员账号登录"+"<a href=\"login.aspx\">返回登录</a>");
                }
                Session["AdminName"] = username;
                Session["AdminId"] = LoginId;
                Session["AdminStatus"] = AdminStatus;
                Session["AdminRoleId"] = RoleId;
                if(AdminStatus)
                {
                    Response.Redirect("show.aspx");
                }
                    
            }
            conn.Close();
            reader.Close();
        }
        catch(Exception es)
        {
            Response.Write("除了一些错误，信息如下：\n"+es.Message);
        }
    }
}
```



Logout.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="Logout.aspx.cs" Inherits="AdminLogout" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
</head>
<body>
    <form id="form1" runat="server">
        <div>
        </div>
    </form>
</body>
</html>

```



Logout.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class AdminLogout : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if(!IsPostBack)
        {
            string Identity = Request.QueryString["identity"];
            if(Identity=="Admin")
            {
                if (Session["AdminName"] != null)
                    Session.Remove("AdminName");
                if (Session["AdminId"] != null)
                    Session.Remove("AdminId");
                if (Session["AdminStatus"] != null)
                    Session.Remove("AdminStatus");
                if (Session["AdminRoleId"] != null)
                    Session.Remove("AdminRoleId");
            }
            else if(Identity=="Cashier")
            {
                if (Session["curSalesPersonId"] != null)
                    Session.Remove("curSalesPersonId");
                if (Session["curSPName"] != null)
                    Session.Remove("curSPName");
                
            }
            else if(Identity=="Member")
            {

            }
            
            Response.Redirect("index.aspx");
        }
    }
}
```



MemberDelete.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="MemberDelete.aspx.cs" Inherits="MemberDelete" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-会员删除界面</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h1>海之星超市-会员删除界面</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
     <a href="MemberManage.aspx">返回会员管理界面</a><br /><br />
    <form id="form1" runat="server">
        <div>
            会员编号:<asp:TextBox ID="TextBox_id" runat="server" ReadOnly="true" ></asp:TextBox> <br />
            会员姓名:<asp:TextBox ID="TextBox_name" runat="server" ReadOnly="true" ></asp:TextBox> <br />
            会员电话:<asp:TextBox ID="TextBox_phone" runat="server" ReadOnly="true"></asp:TextBox> <br />
            会员住址:<asp:TextBox ID="TextBox_address" runat="server" ReadOnly="true"></asp:TextBox> <br />
            会员积分:<asp:TextBox ID="TextBox_point" runat="server" ReadOnly="true"></asp:TextBox> <br />
            注册日期:<asp:TextBox ID="TextBox_opentime" runat="server" ReadOnly="true"></asp:TextBox> <br />
            失效日期:<asp:TextBox ID="TextBox_edtime" runat="server" ReadOnly="true"></asp:TextBox> <br />
            是否过期:<asp:TextBox ID="TextBox_overdue" runat="server" ReadOnly="true" ></asp:TextBox> <br />
            <asp:Button ID="Button_Submit" runat="server" Text="确认删除" OnClick="Button_Submit_Click" />
            <p id="showResult" runat="server" name="showResult" class="showMessage"></p>
        </div>
    </form>
</body>
</html>

```



MemberDelete.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class MemberDelete : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if(!IsPostBack)
        {
            string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
            AdminInf.InnerHtml = htmlstr;
            TextBox_id.Text = Request.QueryString["MemberId"];
            TextBox_name.Text = Request.QueryString["MemberName"];
            TextBox_point.Text = Request.QueryString["Points"];
            TextBox_phone.Text = Request.QueryString["PhoneNumber"];
            TextBox_address.Text = Request.QueryString["MemberAddress"];
            TextBox_opentime.Text = Request.QueryString["Opentime"];
            TextBox_edtime.Text = Request.QueryString["Endtime"];
            TextBox_overdue.Text = Request.QueryString["Overdue"];
        }
    }

    protected void Button_Submit_Click(object sender, EventArgs e)
    {
        string MemberId = TextBox_id.Text;
        if(MemberId=="")
        {
            return;
        }
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }

            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            string str_delete = "delete from SMMembers where MemberId="+MemberId+";";
            command.CommandText = str_delete;
            int f = command.ExecuteNonQuery();
            if (f != 0)
            {
                showResult.InnerHtml = "会员号为[" + MemberId + "],姓名为[" + Request.QueryString["MemberName"] + "]的会员账号删除成功！请点击链接返回会员管理页面";
                TextBox_id.Text = "";
                TextBox_name.Text = "";
                TextBox_point.Text = "";
                TextBox_phone.Text = "";
                TextBox_address.Text = "";
                TextBox_opentime.Text = "";
                TextBox_edtime.Text = "";
                TextBox_overdue.Text = "";
            }
            else
            {
                showResult.InnerHtml = "会员号为[" + MemberId + "],姓名为[" + Request.QueryString["MemberName"] + "]的会员账号删除失败！";
            }
            conn.Close();
        }
        catch (Exception es)
        {
            showResult.InnerHtml = "会员号为[" + MemberId + "],姓名为[" + Request.QueryString["MemberName"] + "]的会员账号删除过程中出现了一点儿错误，错误信息如下：\n" + es.Message;
        }

    }
}
```



MemberManage.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="MemberManage.aspx.cs" Inherits="MemberManage" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-会员管理</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h1>海之星超市-会员管理</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
    <a href="show.aspx">返回管理员功能目录界面</a><br /><br />
    <form id="form1" runat="server">
        <div style="background-color:bisque; width: 991px; margin-left: 265px;">
            添加会员:<br />
            会员姓名:<asp:TextBox ID="TextBox_MemberName" runat="server"></asp:TextBox><br />
            会员电话:<asp:TextBox ID="TextBox_MemberPhoneNumber" runat="server"></asp:TextBox><br />
            会员住址:<asp:TextBox ID="TextBox_MemberAddress" runat="server"></asp:TextBox><br />
            <asp:RegularExpressionValidator runat="server" ID="PhoneNumberValidator" ControlToValidate="TextBox_MemberPhoneNumber" 
               Display="Static" ErrorMessage="电话号码必须存在并且格式为ddd-dddd-dddd" ValidationExpression="^1[3|4|5|7|8][0-9]-\d{4}-\d{4}$" ForeColor="Red" Font-Size="Small"  >
            </asp:RegularExpressionValidator><br />
            <asp:Button ID="Button_Add" runat="server" Text="添加" OnClick="Button_Add_Click" />&nbsp;&nbsp;
            <asp:Button ID="Button2_Reset" runat="server" Text="取消" OnClick="Button2_Reset_Click" /><br />
            <p id="AddResult" name="AddResult" runat="server" class="showMessage"></p>
         </div>
        <br /><br />
        <div style="background-color:bisque; width: 1004px; margin-left: 258px;">
            <asp:Button ID="Button_QueryAllMember" runat="server" Text="显示会员" OnClick="Button_QueryAllMember_Click" />
            <asp:Button ID="Button_Clear" runat="server" Text="清除" OnClick="Button_Clear_Click" /><br />
            <p id="showAllMmeber" runat="server" name="showAllMember" class="showMessage" ></p>
        </div>
    </form>
</body>
</html>

```



MemberManage.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Text.RegularExpressions; //C#正则表达式
using System.Data.SqlClient; //SQL Server数据库

public partial class MemberManage : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if(!IsPostBack)
        {
            string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
            AdminInf.InnerHtml = htmlstr;
        }
    }

    protected void Button2_Reset_Click(object sender, EventArgs e)
    {
        TextBox_MemberAddress.Text = "";
        TextBox_MemberName.Text = "";
        TextBox_MemberPhoneNumber.Text = "";
        AddResult.InnerHtml = "";
    }

    protected void Button_Add_Click(object sender, EventArgs e)
    {
        string MemberName = TextBox_MemberName.Text;
        string PhoneNumber = TextBox_MemberPhoneNumber.Text;
        string MemberAddress = TextBox_MemberAddress.Text;
        if(MemberName=="")
        {
            AddResult.InnerHtml = "会员姓名不能为空！";
            return;
        }
        if(PhoneNumber=="")
        {
            AddResult.InnerHtml = "会员手机号码不能为空！";
            return;
        }
        if(MemberAddress=="")
        {
            AddResult.InnerHtml = "会员住址不能为空！";
            return;
        }
        if(!Regex.IsMatch(PhoneNumber, @"^1[3|4|5|7|8][0-9]-\d{4}-\d{4}$"))
        {
            AddResult.InnerHtml = "手机号格式不正确或不合法";
            return;
        }
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }

            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            command.CommandText = "select * from  SMMembers where PhoneNumber='" + PhoneNumber + "'";
            var reader = command.ExecuteReader();
            if (!reader.HasRows) //说明这个手机号没有被人注册过，可以注册
            {
                reader.Close();
                //insert into SMMembers(MemberName,Points,PhoneNumber,MemberAddress,OpenTime,MemberStatus) values('郭靖',default,'173-6299-2401','襄阳',default,default);
                string str_insert = "insert into SMMembers(MemberName,Points,PhoneNumber,MemberAddress,OpenTime,MemberStatus) values('{0}',default,'{1}','{2}',default,default);";
                str_insert = string.Format(str_insert, MemberName, PhoneNumber, MemberAddress);
                command.CommandText = str_insert;
                int f = command.ExecuteNonQuery();
                if (f != 0)
                {
                    AddResult.InnerHtml = "会员[" + MemberName + "]电话:[" + PhoneNumber + "]添加成功！";
                    TextBox_MemberAddress.Text = "";
                    TextBox_MemberName.Text = "";
                    TextBox_MemberPhoneNumber.Text = "";
                }
                else
                {
                    AddResult.InnerHtml = "会员[" + MemberName + "]电话:[" + PhoneNumber + "]未成功添加！";
                }
                //Response.Write("用户名或密码错误！<a href=\"login.aspx\">返回重试</a>");
            }
            else
            {
                AddResult.InnerHtml = "手机号" + PhoneNumber + "已经被注册过了,可以使用其它手机号码注册添加会员"; 
            }
            conn.Close();
        }
        catch (Exception es)
        {
            AddResult.InnerHtml = "出现了一点儿错误，错误信息如下：\n" + es.Message;
        }
    }

    protected void Button_QueryAllMember_Click(object sender, EventArgs e)
    {
        string HTML = "<table><caption>超市会员信息表</caption><tr><th>序号</th><th>会员编号</th><th>会员姓名</th><th>积分</th><th>手机号码</th><th>住址</th><th>注册日期</th><th>失效日期</th><th>是否失效</th><th>会员状态</th><th>操作</th></tr>";
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            command.CommandText = "select * from SMMembers;";
            var reader = command.ExecuteReader();
            if (reader.HasRows)
            {
                int cntt = 0;
                while (reader.Read())
                {
                    ++cntt;
                    string MemberId = reader.GetInt32(0).ToString();
                    string MemberName = reader["MemberName"].ToString();
                    string Points = reader.GetInt32(2).ToString();
                    string PhoneNumber = reader["PhoneNumber"].ToString();
                    string MemberAddress = reader["MemberAddress"].ToString();
                    DateTime opDate = new DateTime();
                    DateTime edDate = new DateTime();
                    opDate = reader.GetDateTime(5);
                    edDate = opDate.AddDays(365);
                    string OpenTime = opDate.ToString("yyyy-MM-dd");
                    string EndTime = edDate.ToString("yyyy-MM-dd");
                    string MemberStatus = reader.GetInt32(6).ToString();
                    string State = "";
                    if(MemberStatus=="1")
                    {
                        State = "正常";
                    }
                    else if(MemberStatus=="0")
                    {
                        State = "冻结中";
                    }
                    else if(MemberStatus == "-1")
                    {
                        State = "已过期";
                    }
                    string Overdue = "未过期";
                    if(DateTime.Now > edDate)
                    {
                        Overdue = "已过期";
                    }

                    string LinkStrDelete = "<a href=\"MemberDelete.aspx?MemberId=" + MemberId + "&MemberName=" + MemberName + "&Points="+ Points+ "&OpenTime="+ 
                        OpenTime+ "&EndTime=" + EndTime+ "&MemberAddress="+ MemberAddress+ "&PhoneNumber="+ PhoneNumber + "&MemberStatus="+ MemberStatus+"&Overdue="+Overdue+ "\">去删除</a>";
                    string LinkStrModify = "<a href=\"MemberModify.aspx?MemberId=" + MemberId + "&MemberName=" + MemberName + "&Points=" + Points + "&OpenTime=" + 
                        OpenTime+ "&EndTime=" + EndTime + "&MemberAddress=" + MemberAddress + "&PhoneNumber=" + PhoneNumber + "&MemberStatus=" + MemberStatus + "&Overdue=" + Overdue + "\">去修改</a>";
                    HTML += "<tr><td>" + cntt.ToString() + "</td><td>" + MemberId + "</td><td>" + MemberName + "</td><td>" + Points + "</td><td>" + PhoneNumber+
                        "</td><td>"+ MemberAddress+"</td><td>"+ OpenTime+"</td><td>"+ EndTime+"</td><td>"+Overdue+"</td><td>"+ State+"</td><td>"+
                        LinkStrDelete + "&nbsp;&nbsp;" + LinkStrModify + "</td></tr>";
                }
            }
            HTML += "</table>";
            showAllMmeber.InnerHtml = HTML;
            reader.Close();
            conn.Close();
        }
        catch (Exception es)
        {
            showAllMmeber.InnerHtml = "出错了！错误信息如下：\n" + es.Message;
        }
        
    }

    protected void Button_Clear_Click(object sender, EventArgs e)
    {
        showAllMmeber.InnerHtml = "";
    }
}
```



MemberModify.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="MemberModify.aspx.cs" Inherits="MemberModify" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-会员信息修改界面</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h1>海之星超市-会员信息修改界面</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
     <a href="MemberManage.aspx">返回会员管理界面</a><br /><br />
    <form id="form1" runat="server">
        <div>
            会员编号:<asp:TextBox ID="TextBox_id" runat="server" ReadOnly="true" ></asp:TextBox><span style="font-size:0.6em;color:darkred;font-family:SimHei;">不可修改</span> <br />
            会员姓名:<asp:TextBox ID="TextBox_name" runat="server" ReadOnly="true"></asp:TextBox><span style="font-size:0.6em;color:darkred;font-family:SimHei;">不可修改</span>  <br />
            会员电话:<asp:TextBox ID="TextBox_phone" runat="server" ReadOnly="true"></asp:TextBox><span style="font-size:0.6em;color:darkred;font-family:SimHei;">不可修改</span>  <br />
            注册日期:<asp:TextBox ID="TextBox_opentime" runat="server" ReadOnly="true"></asp:TextBox><span style="font-size:0.6em;color:darkred;font-family:SimHei;">不可修改</span>  <br />
            失效日期:<asp:TextBox ID="TextBox_edtime" runat="server" ReadOnly="true"></asp:TextBox><span style="font-size:0.6em;color:darkred;font-family:SimHei;">不可修改</span> <br />
            是否过期:<asp:TextBox ID="TextBox_overdue" runat="server" ReadOnly="true"></asp:TextBox><span style="font-size:0.6em;color:darkred;font-family:SimHei;">不可修改</span>  <br />
            会员住址:<asp:TextBox ID="TextBox_address" runat="server"></asp:TextBox><span style="font-size:0.6em;color:blue;font-family:SimHei;">可以修改</span> <br />
            会员积分:<asp:TextBox ID="TextBox_point" runat="server" ></asp:TextBox><span style="font-size:0.6em;color:blue;font-family:SimHei;">可以修改</span> <br />
            会员状态:<asp:DropDownList ID="DropDownList_status" runat="server" style="margin-left: 0px" Width="163px"></asp:DropDownList><span style="font-size:0.6em;color:blue;font-family:SimHei;">可以修改</span> <br />
            <asp:Button ID="Button_Submit" runat="server" Text="确认修改" OnClick="Button_Submit_Click" />
            <asp:Button ID="Button_Reset" runat="server" Text="还原" OnClick="Button_Reset_Click" />
             <p id="showResult" runat="server" name="showResult" class="showMessage"></p>
        </div>
    </form>
</body>
</html>
```



MemberModify.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class MemberModify : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
            AdminInf.InnerHtml = htmlstr;
            TextBox_id.Text = Request.QueryString["MemberId"];
            TextBox_name.Text = Request.QueryString["MemberName"];
            TextBox_point.Text = Request.QueryString["Points"];
            TextBox_phone.Text = Request.QueryString["PhoneNumber"];
            TextBox_address.Text = Request.QueryString["MemberAddress"];
            TextBox_opentime.Text = Request.QueryString["Opentime"];
            TextBox_edtime.Text = Request.QueryString["Endtime"];
            TextBox_overdue.Text = Request.QueryString["Overdue"];
            DropDownList_status.Items.Add(new ListItem("冻结"));
            DropDownList_status.Items.Add(new ListItem("正常"));
            DropDownList_status.Items.Add(new ListItem("过期失效"));
            string Status = Request.QueryString["MemberStatus"];
            int index = 0;
            if (Status == "-1") index = 2;
            else index = Convert.ToInt32(Status);
            DropDownList_status.SelectedIndex = index;
        }
    }

    protected void Button_Reset_Click(object sender, EventArgs e)
    {
        string MemberId = TextBox_id.Text;
        if(MemberId=="") //ID为空表示已经修改过了，不能再次修改。
        {
            return;
        }
        TextBox_point.Text = Request.QueryString["Points"];
        string Status = Request.QueryString["MemberStatus"];
        int index = 0;
        if (Status == "-1") index = 2;
        else index = Convert.ToInt32(Status);
        DropDownList_status.SelectedIndex = index;
        TextBox_address.Text = Request.QueryString["MemberAddress"];

    }

    protected void Button_Submit_Click(object sender, EventArgs e)
    {
        string Points = TextBox_point.Text;
        string MemberAddress = TextBox_address.Text;
        string MemberStatus = DropDownList_status.SelectedIndex.ToString();
        string MemberId = TextBox_id.Text;
        if (MemberId == "") //说明已经修改成功了，不能再改了
        {
            return;
        }
        if(MemberStatus=="2")
        {
            MemberStatus = "-1";
        }
        if(Points=="")
        {
            showResult.InnerHtml = "积分不能为空！";
            return;
        }
        if(MemberAddress=="")
        {
            showResult.InnerHtml = "地址不能为空！";
            return;
        }
        if(Points==Request.QueryString["Points"] && MemberAddress==Request.QueryString["MemberAddress"] && MemberStatus== Request.QueryString["MemberStatus"])
        {
            showResult.InnerHtml = "会员地址，积分，状态都没有改变，不需要更新！";
            return;
        }
        int PointInt = 0;
        try
        {
            PointInt = Convert.ToInt32(Points);
            if(PointInt<0)
            {
                showResult.InnerHtml = "积分必须为非负整数！";
                return;
            }
        }
        catch(Exception es)
        {
            showResult.InnerHtml = "输入的积分不是合法的数字！(" + es.Message;
            return;
        }
       

        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }

            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            string str_update = "update SMMembers set Points=100,MemberAddress='{0}',MemberStatus={1} where MemberId={2};";
            str_update = string.Format(str_update, MemberAddress, MemberStatus, MemberId);
            command.CommandText = str_update;
            int f = command.ExecuteNonQuery();
            if (f != 0)
            {
                showResult.InnerHtml = "会员号为[" + MemberId + "],姓名为[" + Request.QueryString["MemberName"] + "]的会员账号信息修改成功！"+
                    "现在的积分为"+TextBox_point.Text+"分，地址为:"+TextBox_address.Text+",状态为:"+DropDownList_status.Text+"。\n"+"请点击链接返回会员管理页面";
                TextBox_id.Text = "";
                TextBox_name.Text = "";
                TextBox_point.Text = "";
                TextBox_phone.Text = "";
                TextBox_address.Text = "";
                TextBox_opentime.Text = "";
                TextBox_edtime.Text = "";
                TextBox_overdue.Text = "";
            }
            else
            {
                showResult.InnerHtml = "会员号为[" + MemberId + "],姓名为[" + Request.QueryString["MemberName"] + "]的会员信息修改失败！";
            }
            conn.Close();
        }
        catch (Exception es)
        {
            showResult.InnerHtml = "会员号为[" + MemberId + "],姓名为[" + Request.QueryString["MemberName"] + "]的会员账号信息修改过程中出现了一点儿错误，错误信息如下：\n" + es.Message;
        }
    }
}
```



ProductManage.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="ProductManage.aspx.cs" Inherits="ProductManage" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-商品管理</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body style="text-align:center;margin:0 auto;">
    <h1>海之星超市-商品管理</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
    <a href="show.aspx">返回管理员功能目录</a><br /><br />
    <form id="form1" runat="server"> 
        
        <div>
            增加新的商品:<br/>
            商品编号:<asp:TextBox ID="TextBox_Pid" runat="server" Width="180px"></asp:TextBox><br />
            商品名称:<asp:TextBox ID="TextBox_Pname" runat="server" Width="180px"></asp:TextBox><br />
            商品单价:<asp:TextBox ID="TextBox_UnitPrice" runat="server" Width="180px"></asp:TextBox>
                       <br />
            商品折扣:<asp:DropDownList ID="DropDownList_Discount" runat="server" style="margin-left: 0px" Width="187px"></asp:DropDownList>
            
            <br />
            计量单位:<asp:DropDownList ID="DropDownList_Unit" runat="server" Width="188px"></asp:DropDownList><br />
            商品类别:<asp:DropDownList ID="DropDownList_PCategory" runat="server" Width="188px"></asp:DropDownList><br/>
             <asp:RegularExpressionValidator ID="PriceValidator" ControlToValidate="TextBox_UnitPrice" Display="Static"
                runat="server" ErrorMessage="输入的价格必须为数字！" ValidationExpression="(?!0\d)\d*(\.\d+)?$" ForeColor="Red" Font-Size="Small" ></asp:RegularExpressionValidator>           
            <br />
            <asp:Button ID="AddProduct" runat="server" Text="添加商品" OnClick="AddProduct_Click" />
            <asp:Button ID="Button_Reset" runat="server" Text="清空重置" OnClick="Button_Reset_Click" Width="89px" /><br />
            <p id="showInsertResult" name="showInsertResult" runat="server" class="showMessage"></p>
        </div>
        <div>
            <asp:Button ID="Button_QueryAllProduct" runat="server" Text="查询所有商品" OnClick="Button_QueryAllProduct_Click" />
            <asp:Button ID="Button_QueryClear" runat="server" Text="清除查询结果" OnClick="Button_QueryClear_Click" />
            <p id="showAllProduct" runat="server"></p>
        </div>
    </form>
</body>
</html>

```



ProductManage.aspx

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class ProductManage : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
            AdminInf.InnerHtml = htmlstr;
            //为折扣下拉框添加折扣选项
            for (int i=10;i>=1;--i)
            {
                DropDownList_Discount.Items.Add(i.ToString());
            }
            try
            {
                //第一步，新建连接对象
                SqlConnection conn = new SqlConnection();
                //第二步，给连接对象指定参数（连接字符串）
                conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
                //第三步，开始建立连接
                if (conn.State != System.Data.ConnectionState.Open)
                {
                    conn.Open();
                }
                SqlCommand command = new SqlCommand();
                command.Connection = conn;
                command.CommandText = "select Unit from ProductUnit;";
                var reader = command.ExecuteReader();
                if (reader.HasRows)
                {
                    while (reader.Read())
                    {
                        DropDownList_Unit.Items.Add(reader["Unit"].ToString());
                    }
                }
                reader.Close();
                command.CommandText = "select CategoryName from ProductCategory;";
                var reader2 = command.ExecuteReader();
                if(reader2.HasRows)
                {
                    while(reader2.Read())
                    {
                        DropDownList_PCategory.Items.Add(reader2["CategoryName"].ToString());
                    }
                }
                reader2.Close();
                conn.Close();
            }
            catch (Exception es)
            {
                Response.Write("出错了！错误信息如下：\n" + es.Message);
            }
        }
    }

    protected void AddProduct_Click(object sender, EventArgs e)
    {
        string ProductId = TextBox_Pid.Text;
        string ProductName = TextBox_Pname.Text;
        string UnitPrice = TextBox_UnitPrice.Text;
        if (ProductId == "" || ProductName == "" || UnitPrice == "")
        { //输入为空则不执行
            return;
        }
        string Unit = DropDownList_Unit.Text;
        string Discount = DropDownList_Discount.Text;
        string CategoryId = (DropDownList_PCategory.SelectedIndex + 1).ToString();
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }

            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            string str_insert = "insert into Products(ProductId,ProductName,UnitPrice,Unit,Discount,categoryId) values('{0}','{1}',{2},'{3}',{4},{5});";
            str_insert = string.Format(str_insert, ProductId, ProductName, UnitPrice,Unit,Discount,CategoryId);
            command.CommandText = str_insert;
            int f = command.ExecuteNonQuery();
            if (f != 0)
            {
                showInsertResult.InnerHtml = "商品[" + ProductName + "]编号为[" + ProductId + "]插入成功！";
            }
            else
            {
                showInsertResult.InnerHtml = "商品[" + ProductName + "]编号为[" + ProductId + "]插入失败！";
            }
            conn.Close();
        }
        catch (Exception es)
        {
            showInsertResult.InnerHtml = "商品[" + ProductName + "]编号为[" + ProductId + "]插入过程中出错了！错误信息如下:\n"+es.Message;
        }
    }

    protected void Button_Reset_Click(object sender, EventArgs e)
    {
        TextBox_Pid.Text = "";
        TextBox_Pname.Text = "";
        TextBox_UnitPrice.Text = "";
        DropDownList_Discount.SelectedIndex = 0;
        DropDownList_PCategory.SelectedIndex = 0;
        DropDownList_PCategory.SelectedIndex = 0;
        showInsertResult.InnerHtml = "";
    }

    protected void Button_QueryClear_Click(object sender, EventArgs e)
    {
        showAllProduct.InnerHtml = "";
    }

    protected void Button_QueryAllProduct_Click(object sender, EventArgs e)
    {
        string HTML = "";
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            command.CommandText = "select * from Products";
            var reader = command.ExecuteReader();
            int cntt = 0;
            HTML = "<table><tr><th>序号</th><th>商品编号</th><th>商品名称</th><th>商品单价</th><th>计量单位</th><th>折扣</th><th>操作</th></tr>";
            if (reader.HasRows)
            {
                while (reader.Read())
                {
                    string ProductId = reader["ProductId"].ToString();
                    string ProductName = reader["ProductName"].ToString();
                    string UnitPrice = reader.GetDecimal(2).ToString();
                    string Unit = reader["Unit"].ToString();
                    string Discount = reader.GetInt32(4).ToString();
                    string CategoryId = reader.GetInt32(5).ToString();
                    cntt += 1;
                    string Linkstr = "<a href=\"ProductModify.aspx?ProductId="+ProductId+ "&ProductName="+ProductName+ "&UnitPrice="
                        +UnitPrice+ "&Discount="+Discount+ "\">修改</a>";
                    HTML += "<tr><td>" + cntt.ToString() + "</td><td>" + ProductId + "</td><td>" + ProductName + "</td><td>"+UnitPrice+
                        "</td><td>"+Unit+"</td><td>"+Discount+"</td><td>"+Linkstr+"</td></tr>";
                }
            }
            HTML += "</table>";
            reader.Close();
            conn.Close();
        }
        catch (Exception es)
        {
            Response.Write("出错了！错误信息如下：\n" + es.Message);
        }
        showAllProduct.InnerHtml = HTML;
    }
}
```



ProductModify.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="ProductModify.aspx.cs" Inherits="ProductModify" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-商品修改</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h1>海之星超市-商品修改</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
    <form id="form1" runat="server">
        <div>
            商品编号:<asp:TextBox ID="TextBox_Pid" runat="server" ReadOnly="true"></asp:TextBox><span style="font-size:0.7em;">不可修改</span><br />
            商品名称:<asp:TextBox ID="TextBox_Pname" runat="server" ReadOnly="true"></asp:TextBox><span style="font-size:0.7em;">不可修改</span><br />
            计量单位:<asp:TextBox ID="TextBox_Unit" runat="server" ReadOnly="true"></asp:TextBox><span style="font-size:0.7em;">不可修改</span><br />
            商品单价:<asp:TextBox ID="TextBox_UnitPrice" runat="server"></asp:TextBox><span style="font-size:0.7em;">可以修改</span><br />
            商品折扣:<asp:DropDownList ID="DropDownList_Discount" runat="server" Width="188px"></asp:DropDownList><span style="font-size:0.7em;">可以修改</span><br />
            <asp:RegularExpressionValidator ID="PriceValidator" ControlToValidate="TextBox_UnitPrice" Display="Static"
                runat="server" ErrorMessage="输入的价格必须为数字！" ValidationExpression="(?!0\d)\d*(\.\d+)?$" ForeColor="Red" Font-Size="Small" ></asp:RegularExpressionValidator>           
            <br />
            <asp:Button ID="Button_Submit" runat="server" Text="确认修改" OnClick="Button_Submit_Click" />
            <asp:Button ID="Button_Reset" runat="server" Text="还原" OnClick="Button_Reset_Click" />
            <asp:Button ID="Button_Back" runat="server" Text="返回商品管理" OnClick="Button_Back_Click" Width="129px" />
        </div>
        <p id="InsertResult" class="showMessage" runat="server"></p>
        <p>
            <a href="InventoryManage.aspx">去查询库存</a>
        </p>
    </form>
</body>
</html>
```



ProductModify.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class ProductModify : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if(!IsPostBack)
        {
            string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
            AdminInf.InnerHtml = htmlstr;
            for (int i=10;i>=1;--i)
            {
                DropDownList_Discount.Items.Add(i.ToString());
            }
            string ProductId = Request.QueryString["ProductId"];
            string ProductName = Request.QueryString["ProductName"];
            string UnitPrice = Request.QueryString["UnitPrice"];
            int Discount = 10-Convert.ToInt32(Request.QueryString["Discount"]);
            if(Discount<0)
            {
                Discount = 0;
            }
            if(Discount>9)
            {
                Discount = 9;
            }
            TextBox_Pid.Text = ProductId;
            TextBox_Pname.Text = ProductName;
            TextBox_UnitPrice.Text = UnitPrice;
            TextBox_Unit.Text = Request.QueryString["Unit"];
            DropDownList_Discount.SelectedIndex = Discount;
        }
    }

    protected void Button_Reset_Click(object sender, EventArgs e)
    {
        TextBox_UnitPrice.Text = Request.QueryString["UnitPrice"];
        int Discount = 10-Convert.ToInt32(Request.QueryString["Discount"]);
        if(Discount<0)
        {
            Discount = 0;
        }
        if(Discount>9)
        {
            Discount = 9;
        }
        DropDownList_Discount.SelectedIndex = Discount;
        InsertResult.InnerHtml = "";
    }

    protected void Button_Back_Click(object sender, EventArgs e)
    {
        Response.Redirect("ProductManage.aspx");
    }

    protected void Button_Submit_Click(object sender, EventArgs e)
    {
        string ProductId = TextBox_Pid.Text;
        string Discount = DropDownList_Discount.Text;
        string UnitPrice = TextBox_UnitPrice.Text;
        string ProductName = Request.QueryString["ProductName"];
        if (UnitPrice== Request.QueryString["UnitPrice"] && Discount== Request.QueryString["Discount"])
        {
            InsertResult.InnerHtml = "商品"+Request.QueryString["ProductName"]+"的价格和折扣都没有改变，不需要更新！";
            return;
        }
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            string str_insert = "update Products set UnitPrice={0},Discount={1} where ProductId='{2}';";
            str_insert = string.Format(str_insert, UnitPrice, Discount,ProductId);
            command.CommandText = str_insert;
            int f = command.ExecuteNonQuery();
            if (f != 0)
            {
                InsertResult.InnerHtml = "商品" + ProductName + "Id为["+ProductId+"]信息修改成功！单价为:￥" + UnitPrice + ",折扣为" + Discount + "折。请点击按钮返回商品管理";
                TextBox_Pid.Text = "";
                TextBox_Pname.Text = "";
            }
            else
            {
                InsertResult.InnerHtml = "没有商品被修改";
            }
            conn.Close();
        }
        catch (Exception es)
        {
            InsertResult.InnerHtml = "出现了错误，错误信息如下：\n" + es.Message;
        }
    }
}
```



PurchaseManage.aspx

```asp
 <%@ Page Language="C#" AutoEventWireup="true" CodeFile="PurchaseManage.aspx.cs" Inherits="PurchaseManage" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-进货管理</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
    <style type="text/css">
        #st_date {
            width: 150px;
        }
        #ed_date {
            width: 150px;
        }
        #purchase_date {
            width: 361px;
            background-color:darksalmon;
        }
        input.date {background-color:darksalmon;}
                    
    </style>
</head>
<body>
    <h1>海之星超市-进货管理</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
    <p>
        <a href="InventoryManage.aspx">去查询库存</a>&nbsp;&nbsp;
        <a href="show.aspx">返回管理员功能目录</a>
    </p>
    <form id="form1" runat="server" method="post" action="#">
        <div>
            
            <table>
                <caption>添加进货信息</caption>
                <tr>
                    <th>货物编号:</th>
                    <td>
                        <asp:TextBox ID="TextBox_Pid" runat="server" ReadOnly="true" Width="365px" BackColor="DarkSalmon" BorderColor="DarkSalmon"></asp:TextBox>
                    </td>
                </tr>
                <tr>
                    <th>货物名称:</th>
                    <td>
                        <asp:TextBox ID="TextBox_Pname" runat="server" ReadOnly="true" Width="365px" BackColor="DarkSalmon" BorderColor="DarkSalmon"></asp:TextBox>
                    </td>
                </tr>
                <tr>
                    <th>出售单价:</th>
                    <td>
                        <asp:TextBox ID="TextBox_SellUnitPrice" runat="server" ReadOnly="true" Width="365px" BackColor="DarkSalmon" BorderColor="DarkSalmon"></asp:TextBox>
                    </td>
                </tr>
                <tr>
                    <th>计量单位:</th>
                    <td>
                        <asp:TextBox ID="TextBox_Unit" runat="server" ReadOnly="true" Width="365px" BackColor="DarkSalmon" BorderColor="DarkSalmon"></asp:TextBox>
                    </td>
                </tr>
                <tr>
                    <th>进货数量:</th>
                    <td>
                        <asp:TextBox ID="TextBox_PurchaseCnt" runat="server" Width="365px" BackColor="DarkSalmon" BorderColor="DarkSalmon"></asp:TextBox>
                         
                    </td>
                </tr>
                <tr>
                    <th>进货价格:</th>
                    <td>
                        <asp:TextBox ID="TextBox_PurchasePrice" runat="server" Width="360px" BackColor="DarkSalmon" BorderColor="DarkSalmon"></asp:TextBox>
                        
                    </td>
                </tr>
                <tr>
                    <th>总进价:￥</th>
                    <td>
                        <asp:TextBox ID="TextBox_TotalPrice" runat="server" Width="361px" BackColor="DarkSalmon" BorderColor="DarkSalmon"></asp:TextBox>
                    </td>
                </tr>
                <tr>  
                    <th>进货日期:</th>
                    
                    <td><input type="date" id="purchase_date" name="purchase_date" runat="server" /></td>
                </tr>

                <tr>
                    <td colspan="2">
                        <asp:RegularExpressionValidator ID="PurchaseCntValidator" ControlToValidate="TextBox_PurchaseCnt"
                            Display="Static" runat="server" ErrorMessage="进货数量必须为正整数！" ForeColor="Blue" Font-Size="Small" 
                            ValidationExpression="^[1-9]\d*$"></asp:RegularExpressionValidator>

                        <asp:RegularExpressionValidator ID="PriceValidator" ControlToValidate="TextBox_PurchasePrice"
                            Display="Static" runat="server" ErrorMessage="进价必须为正数！" ForeColor="Blue" Font-Size="Small" 
                            ValidationExpression="^(?:[1-9]\d*|0)?(?:\.\d+)?$"></asp:RegularExpressionValidator>

                        <asp:RegularExpressionValidator ID="TotalPriceValidator" ControlToValidate="TextBox_TotalPrice"
                            Display="Static" runat="server" ErrorMessage="总进价必须为正数！" ForeColor="Blue" Font-Size="Small" 
                            ValidationExpression="^(?:[1-9]\d*|0)?(?:\.\d+)?$"></asp:RegularExpressionValidator>
                     </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <asp:Button ID="Button_CalPrice" runat="server" Text="计算总价" OnClick="Button_CalPrice_Click" />
                        <asp:Button ID="Button_Submit" runat="server" Text="提交" OnClick="Button_Submit_Click" />
                        <asp:Button ID="Button_Reset" runat="server" Text="重置" OnClick="Button_Reset_Click" />
                    </td>
                </tr>
             </table>
            <p id="InsertResult" class="showMessage" runat="server" ></p>
        </div>
        <br/><br />
        <div style="background-color:cornflowerblue; width: 930px; margin-left: 247px;">
            进货信息查询:<asp:DropDownList ID="DropDownList1" runat="server" OnSelectedIndexChanged="DropDownList1_SelectedIndexChanged" AutoPostBack="true"></asp:DropDownList>
            &nbsp;&nbsp;开始时间<input type="date" id="st_date" name="st_date" runat="server"/>
            &nbsp;&nbsp;结束时间<input type="date" id="ed_date" name="ed_date" runat="server" />
            <asp:Button ID="Button_Query" runat="server" Text="查询进货信息" OnClick="Button_Query_Click" /><br />
            <p id="showDate" name="showDate" class="showMessage" runat="server" ></p>
            
        </div>
    </form>
</body>
</html>
```



PurchaseManage.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class PurchaseManage : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if(!IsPostBack)
        {
            TextBox_Pid.Text = Request.QueryString["ProductId"];
            TextBox_Pname.Text = Request.QueryString["ProductName"];
            TextBox_SellUnitPrice.Text = Request.QueryString["UnitPrice"];
            TextBox_Unit.Text = Request.QueryString["Unit"];
            DateTime dateTime = DateTime.Now;
            string strDate = dateTime.ToString("yyyy-MM-dd");
            purchase_date.Value = strDate;
            st_date.Value = strDate;
            ed_date.Value = strDate;

            string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
            AdminInf.InnerHtml = htmlstr;
        }

      
        if (!IsPostBack)
        {
            DropDownList1.Items.Add(new ListItem("当日"));
            DropDownList1.Items.Add(new ListItem("一周内"));
            DropDownList1.Items.Add(new ListItem("一月内"));
            DropDownList1.Items.Add(new ListItem("一年内"));
            DropDownList1.Items.Add(new ListItem("自定义范围"));
        }
    }

    protected void Button_CalPrice_Click(object sender, EventArgs e)
    {
        try
        {
            string UnitPrice = TextBox_PurchasePrice.Text;
            string Cnt = TextBox_PurchaseCnt.Text;
            if (UnitPrice == "" || Cnt == "") return; //有空的，不用计算
            decimal tot = Convert.ToDecimal(UnitPrice) * Convert.ToInt32(Cnt);
            TextBox_TotalPrice.Text = tot.ToString();
        }
        catch(Exception es)
        {

        }
    }

    protected void Button_Reset_Click(object sender, EventArgs e)
    {
        TextBox_PurchaseCnt.Text = "";
        TextBox_PurchasePrice.Text = "";
        TextBox_TotalPrice.Text = "";
        DateTime dateTime = DateTime.Now;
        string strDate = dateTime.ToString("yyyy-MM-dd");
        purchase_date.Value = strDate;
        InsertResult.InnerHtml = "";
    }

    protected void Button_Submit_Click(object sender, EventArgs e)
    {
        string ProductId = ""; //货物ID
        string PurchasePrice = ""; //进货单价
        string PurchaseCnt = ""; //进货数量
        string PurchaseTotPrice = ""; //进货总价
        string PurchaseDate = ""; //进货日期
        ProductId = TextBox_Pid.Text;
        PurchasePrice = TextBox_PurchasePrice.Text;
        PurchaseCnt = TextBox_PurchaseCnt.Text;
        PurchaseTotPrice = TextBox_TotalPrice.Text;
        PurchaseDate = purchase_date.Value;
        if(PurchaseDate=="")
        {
            PurchaseDate = DateTime.Now.ToString("yyyy-MM-dd");
        }
        if(PurchaseCnt==""|| PurchasePrice==""|| PurchaseTotPrice=="")
        {
            InsertResult.InnerHtml = "进货信息不完整！";
            return;
        }
        try
        {
            int Cnt = Convert.ToInt32(PurchaseCnt);
            if(Cnt<=0)
            {
                InsertResult.InnerHtml = "进货数量必须为正整数！";
                return;
            }
            Decimal Price = Convert.ToDecimal(PurchasePrice);
            if(Price<=0)
            {
                InsertResult.InnerHtml = "进价必须为正数！";
                return;
            }
            Decimal TotP = Convert.ToDecimal(PurchaseTotPrice);
            if(TotP<=0)
            {
                InsertResult.InnerHtml = "总进价必须为正数！";
                return;
            }
        }
        catch(Exception es)
        {
            InsertResult.InnerHtml = "输入的进价或数量格式不正确！";
            return;
        }
        string MessageStr = "ID:" + ProductId+" "+Request.QueryString["ProductName"] + " 进价:" + PurchasePrice + " 数量:" + PurchaseCnt + " 总价:￥" + PurchaseTotPrice + " 日期:" + PurchaseDate;

        string str_insert = "";
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }

            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            str_insert = "insert into Purchase(ProductId,PurchasePrice,PurchaseCnt,PurchaseTotPrice,PurchaseDate) values('{0}',{1},{2},{3},'{4}');";
            str_insert = string.Format(str_insert, ProductId, PurchasePrice, PurchaseCnt, PurchaseTotPrice, PurchaseDate);
            command.CommandText = str_insert;
            int f = command.ExecuteNonQuery();
            if (f != 0)
            {
                InsertResult.InnerHtml = MessageStr+" 进货单插入成功！";
                TextBox_PurchaseCnt.Text = "";
                TextBox_PurchasePrice.Text = "";
                TextBox_TotalPrice.Text = "";
                DateTime dateTime = DateTime.Now;
                string strDate = dateTime.ToString("yyyy-MM-dd");
                purchase_date.Value = strDate;
            }
            else
            {
                InsertResult.InnerHtml = MessageStr + " 进货单插入失败！";
            }
            conn.Close();
        }
        catch (Exception es)
        {
            InsertResult.InnerHtml = MessageStr + "插入过程中出错了！错误信息如下:\n" + es.Message;
        }
    }

    protected void DropDownList1_SelectedIndexChanged(object sender, EventArgs e)
    {
        int index = DropDownList1.SelectedIndex;
        if(index==0)
        {
            st_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
            ed_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
        }
        else if(index==1)
        {
            st_date.Value = DateTime.Now.AddDays(-7).ToString("yyyy-MM-dd");
            ed_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
        }
        else if(index==2)
        {
            st_date.Value = DateTime.Now.AddDays(-30).ToString("yyyy-MM-dd");
            ed_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
        }
        else if(index==3)
        {
            st_date.Value = DateTime.Now.AddDays(-365).ToString("yyyy-MM-dd");
            ed_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
        }
    }

    protected void Button_Query_Click(object sender, EventArgs e)
    {
        string str_Stdate = st_date.Value;
        string str_Eddate = ed_date.Value;
        string str_TMP = str_Eddate;
        DateTime dateSt = new DateTime();
        DateTime dateEd = new DateTime();
        dateSt = DateTime.Now;
        dateEd = DateTime.Now;
        decimal totMoney = 0;
        try
        {
            dateSt = Convert.ToDateTime(str_Stdate);
            dateEd = Convert.ToDateTime(str_Eddate);
        }
        catch(Exception es)
        {
            showDate.InnerHtml = "有异常。信息如下\n"+es.Message;
            return;
        }
        dateEd = dateEd.AddDays(1);
        str_Stdate = dateSt.ToString("yyyy-MM-dd");
        str_Eddate = dateEd.ToString("yyyy-MM-dd");
        string HTML = "<table><caption>【" + str_Stdate + "至" + str_TMP + "】期间的进货单</caption>";
        HTML += "<tr><th>序号</th><th>进货流水号</th><th>货物编号</th><th>货物名称</th><th>进货单价￥</th><th>进货数量</th><th>计量单位</th>";
        HTML += "<th>进货总金额￥</th><th>进货日期</th></tr>";
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            string sqlStr = "select PurchaseId,tb1.ProductId,ProductName,PurchasePrice,PurchaseCnt,Unit,PurchaseTotPrice,PurchaseDate from Purchase as tb1 left join Products as tb2 on tb1.ProductId=tb2.ProductId where PurchaseDate between '{0}' and '{1}';";
            sqlStr = string.Format(sqlStr, str_Stdate, str_Eddate);
            command.CommandText = sqlStr;
            var reader = command.ExecuteReader();
            if (reader.HasRows)
            {
                int cntt = 0;
                while (reader.Read())
                {
                    ++cntt;
                    string PurchaseId = reader.GetInt32(0).ToString();
                    string ProductId = reader["ProductId"].ToString();
                    string ProductName = reader["ProductName"].ToString();
                    string PurchasePrice = reader.GetDecimal(3).ToString();
                    string PurchaseCnt = reader.GetInt32(4).ToString();
                    string Unit = reader["PurchaseCnt"].ToString();
                    decimal money = reader.GetDecimal(6);
                    totMoney += money;
                    string PurchaseTotPrice =money.ToString();
                    string PurchaseDate = reader.GetDateTime(7).ToString("yyyy-MM-dd");
                    HTML += "<tr><td>" + cntt.ToString() + "</td><td>" + PurchaseId + "</td><td>" + ProductId + "</td><td>" + ProductName + "</td><td>" +PurchasePrice 
                        + "</td><td>" + PurchaseCnt + "</td><td>" + Unit + "</td><td>" + PurchaseTotPrice + "</td><td>" + PurchaseDate + "</td></tr>";

                }
            }
            HTML += "</table>";
            HTML += "这段时间内进货支出的总金额为:￥" + totMoney.ToString();
            showDate.InnerHtml = HTML;
            reader.Close();
            conn.Close();
        }
        catch (Exception es)
        {
            showDate.InnerHtml = "出错了！错误信息如下：\n" + es.Message;
        }
    }
}
```



ReturnOrderManage.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="ReturnOrderManage.aspx.cs" Inherits="ReturnOrderManage" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-退货管理</title>
     <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
    <style type="text/css">
        #orderId {
            width: 300px;
            margin-left: 0px;
        }
    </style>
</head>
<body>
    <h1>海之星超市-退货管理</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
    <a href="show.aspx">点击返回管理员功能目录</a><br /><br />
    <form id="form1" runat="server">
        <div>
            <label>订单号:</label><asp:DropDownList ID="DropDownList_SerialNum" runat="server"></asp:DropDownList>
            <asp:Button ID="Button_Query" runat="server" Text="查询" OnClick="Button_Query_Click" />
            <span style="color:cyan; font-size:0.7em; font-family:SimHei;">只能退一周以内的商品</span>
        </div>
        <p id="queryResultId" runat="server"></p>
        <div style="background-color:cornflowerblue; width: 1392px;">
            退货订单查询:
            <asp:DropDownList ID="DropDownList_Option" runat="server" AutoPostBack="true" OnSelectedIndexChanged="DropDownList_Option_SelectedIndexChanged"></asp:DropDownList>
            &nbsp;&nbsp;开始时间<input type="date" id="st_date" name="st_date" runat="server"/>
            &nbsp;&nbsp;结束时间<input type="date" id="ed_date" name="ed_date" runat="server" />
             <asp:Button ID="Button_ClearShowReturnOrderSeven" runat="server" Text="清除" OnClick="Button_ClearShowReturnOrderSeven_Click" Width="42px" BackColor="#FFCCCC" />
            <asp:Button ID="Button_Submit" runat="server" Text="查询" OnClick="Button_Submit_Click" />
            <p id="showReturnOrderSevenDays" runat="server"></p>
        </div>
    </form>
</body>
</html>
```



ReturnOrderManage.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class ReturnOrderManage : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if(!IsPostBack)
        {
            //显示管理员信息
            string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
            AdminInf.InnerHtml = htmlstr;

            string NowDate = DateTime.Now.Date.AddDays(1).ToShortDateString();
            string PreDate = DateTime.Now.Date.AddDays(-7).ToShortDateString();


            //查询7天内的所有订单号，加入到下拉框中
            try
            {
                //第一步，新建连接对象
                SqlConnection conn = new SqlConnection();
                //第二步，给连接对象指定参数（连接字符串）
                conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
                //第三步，开始建立连接
                if (conn.State != System.Data.ConnectionState.Open)
                {
                    conn.Open();
                }
                SqlCommand command = new SqlCommand();
                command.Connection = conn;
                command.CommandText = "select SerialNum from SalesList where SaleDate between '" + PreDate + "' and '" + NowDate + "';";
                var reader = command.ExecuteReader();
               // List<Products> productsList = new List<Products>();
                if (reader.HasRows)
                {
                    while (reader.Read())
                    {
                        string serialNum = reader["SerialNum"].ToString();
                        DropDownList_SerialNum.Items.Add(serialNum);
                    }
                }
                reader.Close();
                conn.Close();
            }
            catch (Exception es)
            {
                Response.Write("出错了！错误信息如下：\n" + es.Message);
            }

            DropDownList_Option.Items.Add("当天");
            DropDownList_Option.Items.Add("一周内");
            DropDownList_Option.Items.Add("一个月内");
            DropDownList_Option.Items.Add("一年内");
            DropDownList_Option.Items.Add("自定义");
           
            string strDate = DateTime.Now.ToString("yyyy-MM-dd");
            st_date.Value = strDate;
            ed_date.Value = strDate;


        }
       
    }

    protected void Button_Query_Click(object sender, EventArgs e)
    {
        string strSerialNum = DropDownList_SerialNum.Text;
        string HTML = "";
        //查询该订单相关的流水明细
        try
        {
            HTML = "<table><tr><th>流水明细号</th><th>流水号</th><th>商品编号</th><th>商品名称</th><th>单价</th><th>折扣</th><th>数量</th><th>小计</th><th>操作</th></tr>";
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            command.CommandText = "select * from SalesListDetail where SerialNum = '"+ strSerialNum+"';";
            var reader = command.ExecuteReader();
            // List<Products> productsList = new List<Products>();
            if (reader.HasRows)
            {
                while (reader.Read())
                {
                    string Id = reader.GetInt32(0).ToString();
                    string serialNum = reader["SerialNum"].ToString();
                    string ProductId = reader["ProductId"].ToString();
                    string ProductName = reader["ProductName"].ToString();
                    string UnitPrice = reader.GetDecimal(4).ToString();
                    string Discount = reader.GetInt32(5).ToString();
                    string Quantity = reader.GetInt32(6).ToString();
                    string SubTotalMoney = reader.GetDecimal(7).ToString();
                    string strLink = "<a href=\"ReturnOrderWork.aspx?ProductId="+ProductId+"&SerialNum="+ serialNum + "&rcnt="+
                        Quantity+"&rMoney="+SubTotalMoney+"\" >去退款</a>";
                    HTML += "<tr><td>" + Id + "</td><td>" + serialNum + "</td><td>" + ProductId + "</td><td>" + ProductName
                        + "</td><td>" + UnitPrice + "</td><td>" + Discount + "</td><td>" + Quantity + "</td><td>" + SubTotalMoney
                        +"</td><td>"+ strLink + "</td></tr>";
                        
                }
            }
            HTML += "</table>";
            reader.Close();
            conn.Close();
        }
        catch (Exception es)
        {
            Response.Write("出错了！错误信息如下：\n" + es.Message);
        }
        queryResultId.InnerHtml = HTML;
    }

    protected void Button_showReturnOrderSevenDays_Click(object sender, EventArgs e)
    {
        string HTMLstr = "";
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            command.CommandText = "select * from ReturnProduct";
            var reader = command.ExecuteReader();
            HTMLstr = "<table><caption>7天内的退货信息表</caption>\n<tr><th>退货流水号</th><th>销售流水号</th><th>货物编号</th><th>退货数量</th><th>退货金额￥</th><th>退货日期</th></tr>";
            if (reader.HasRows)
            {
                while (reader.Read())
                {
                    string Rid = reader["ReturnProductId"].ToString();
                    string SNum = reader["SerialNum"].ToString();
                    string Pid = reader["ProductId"].ToString();
                    string Rcnt = reader.GetInt32(3).ToString();
                    string RMondy = reader.GetDecimal(4).ToString();
                    string RDate = reader.GetDateTime(5).ToString("d");
                    HTMLstr += "<tr><td>"+Rid+"</td><td>"+SNum+"</td><td>"+Pid+"</td><td>"+Rcnt+"</td><td>"+RMondy+"</td><td>"+RDate+"</td></tr>";
                }
            }
            HTMLstr += "</table>";
            reader.Close();
            conn.Close();
        }
        catch (Exception es)
        {
            Response.Write("出错了！错误信息如下：\n" + es.Message);
        }
        showReturnOrderSevenDays.InnerHtml = HTMLstr;
    }

    protected void Button_ClearShowReturnOrderSeven_Click(object sender, EventArgs e)
    {
        showReturnOrderSevenDays.InnerHtml = "";
        DropDownList_Option.SelectedIndex = 0;
        string strDate = DateTime.Now.ToString("yyyy-MM-dd");
        st_date.Value = strDate;
        ed_date.Value = strDate;
    }

    protected void Button_BacktoShow_Click(object sender, EventArgs e)
    {
        Response.Redirect("show.aspx");
    }

    protected void DropDownList_Option_SelectedIndexChanged(object sender, EventArgs e)
    {
        int index = DropDownList_Option.SelectedIndex;
        if (index == 0)
        {
            st_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
            ed_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
        }
        else if (index == 1)
        {
            st_date.Value = DateTime.Now.AddDays(-7).ToString("yyyy-MM-dd");
            ed_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
        }
        else if (index == 2)
        {
            st_date.Value = DateTime.Now.AddDays(-30).ToString("yyyy-MM-dd");
            ed_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
        }
        else if (index == 3)
        {
            st_date.Value = DateTime.Now.AddDays(-365).ToString("yyyy-MM-dd");
            ed_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
        }
    }

    protected void Button_Submit_Click(object sender, EventArgs e)
    {
        string str_Stdate = st_date.Value;
        string str_Eddate = ed_date.Value;
        string str_TMP = str_Eddate;
        DateTime dateSt = new DateTime();
        DateTime dateEd = new DateTime();
        dateSt = DateTime.Now;
        dateEd = DateTime.Now;
        decimal totMoney = 0;
        try
        {
            dateSt = Convert.ToDateTime(str_Stdate);
            dateEd = Convert.ToDateTime(str_Eddate);
        }
        catch (Exception es)
        {
            showReturnOrderSevenDays.InnerHtml = "有异常。信息如下\n" + es.Message;
            return;
        }
        dateEd = dateEd.AddDays(1);
        str_Stdate = dateSt.ToString("yyyy-MM-dd");
        str_Eddate = dateEd.ToString("yyyy-MM-dd");
        string HTMLstr = "";
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            command.CommandText = "select * from ReturnProduct where rDate between '"+str_Stdate+"' and '"+str_Eddate+"';";
            var reader = command.ExecuteReader();
            HTMLstr = "<table><caption>【"+str_Stdate+"至"+str_TMP+"】的退货表</caption>\n<tr><th>退货流水号</th><th>销售流水号</th><th>货物编号</th><th>退货数量</th><th>退货金额￥</th><th>退货日期</th></tr>";
            if (reader.HasRows)
            {
                while (reader.Read())
                {
                    string Rid = reader["ReturnProductId"].ToString();
                    string SNum = reader["SerialNum"].ToString();
                    string Pid = reader["ProductId"].ToString();
                    string Rcnt = reader.GetInt32(3).ToString();
                    decimal money = reader.GetDecimal(4);
                    totMoney += money;
                    string RMondy = money.ToString();
                    string RDate = reader.GetDateTime(5).ToString("d");
                    HTMLstr += "<tr><td>" + Rid + "</td><td>" + SNum + "</td><td>" + Pid + "</td><td>" + Rcnt + "</td><td>" + RMondy + "</td><td>" + RDate + "</td></tr>";
                }
            }
            HTMLstr += "</table>";
            HTMLstr += "在此期间的退货总金额为:￥" + totMoney.ToString();
            reader.Close();
            conn.Close();
        }
        catch (Exception es)
        {
            Response.Write("出错了！错误信息如下：\n" + es.Message);
        }
        showReturnOrderSevenDays.InnerHtml = HTMLstr;
    }
}
```



ReturnOrderWork.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="ReturnOrderWork.aspx.cs" Inherits="ReturnOrderWork" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-退货处理页面</title>
     <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h1>海之星超市-退货处理页面</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
    <a href="ReturnOrderManage.aspx">点击返回退货管理页面</a><br /><br />
    <form id="form1" runat="server">
        <div runat="server">
            交易流水:<asp:TextBox ID="TextBox_SerialNum" runat="server" ReadOnly="true" Width="240px"></asp:TextBox><br/>
            商品编号:<asp:TextBox ID="TextBox_Pid" runat="server" ReadOnly="true" Width="240px"></asp:TextBox><br />
            退货数量:<asp:DropDownList ID="DropDownList_rcnt" runat="server" OnSelectedIndexChanged="DropDownList_rcnt_SelectedIndexChanged" style="margin-left: 0px" Width="240px" Autopostback="true"></asp:DropDownList> <br />
            退货金额:<asp:TextBox ID="TextBox_rMoney" runat="server" Width="240px"></asp:TextBox><br />
            <asp:Button ID="Button_Submit" runat="server" Text="确认退货" OnClick="Button_Submit_Click" />
            <asp:Button ID="Button_Back" runat="server" Text="返回退货管理页面" OnClick="Button_Back_Click" />
            <p runat="server" id="showResult" name="showResult" class="showMessage"> </p>
        </div>
    </form>
</body>
</html>
```



ReturnOrderWork.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class ReturnOrderWork : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if(!IsPostBack)
        {
            string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
            AdminInf.InnerHtml = htmlstr;

            string SerialNum = Request.QueryString["SerialNum"];
            string ProductId = Request.QueryString["ProductId"];
            string rcnt = Request.QueryString["rcnt"];
            string rMoney = Request.QueryString["rMoney"];
            //Response.Write("流水号[" + SerialNum + "]商品编号[" + ProductId + "]数量[" + rcnt + "]总价[" + rMoney + "]");
            TextBox_SerialNum.Text = SerialNum;
            TextBox_Pid.Text = ProductId;
            int rCntInt = Convert.ToInt32(rcnt);
            for(int i=rCntInt;i>=1;--i)
            {
                DropDownList_rcnt.Items.Add(i.ToString());
            }
            DropDownList_rcnt.SelectedIndex = 0;
            TextBox_rMoney.Text = rMoney;
            
        }
    }

    protected void DropDownList_rcnt_SelectedIndexChanged(object sender, EventArgs e)
    {
        int selCnt = Convert.ToInt32(DropDownList_rcnt.Text);
        int rCntInt = Convert.ToInt32(Request.QueryString["rcnt"]);
        decimal rMoney = Convert.ToDecimal(Request.QueryString["rMoney"]);
        decimal curMoney = rMoney * (1.0m*selCnt) / (1.0m*rCntInt);
        //Response.Write("总价为:" + rMoney.ToString() + " 现价为:" + curMoney.ToString() + " " + rCntInt.ToString() + "个退了" + selCnt + "个");
        TextBox_rMoney.Text = curMoney.ToString();
    }

    protected void Button_Back_Click(object sender, EventArgs e)
    {
        Response.Redirect("ReturnOrderManage.aspx");
    }

    protected void Button_Submit_Click(object sender, EventArgs e)
    {
        string _SerialNum = TextBox_SerialNum.Text;
        string _ProductId = TextBox_Pid.Text;
        string _rCnt = DropDownList_rcnt.Text;
        string _rMoney = TextBox_rMoney.Text;
        //Response.Write("流水号:" + _SerialNum + " pid:" + _ProductId + " 退货数量:" + _rCnt + " 退货金额:" + _rMoney);
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }

            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            string str_insert = "insert into ReturnProduct(SerialNum,ProductId,rcnt,rMoney,rDate) values('{0}','{1}',{2},{3},default);";
            //Response.Write(str_insert);
            str_insert = string.Format(str_insert, _SerialNum, _ProductId, _rCnt, _rMoney);
            
            command.CommandText = str_insert;
            int f = command.ExecuteNonQuery();
            if (f != 0)
            {
                string say = "商品" + _ProductId + ",数量" + _rCnt + ",金额￥" + _rMoney +
                    "退货成功！";
                showResult.InnerHtml = say;
               // Response.Write(say);
                DropDownList_rcnt.Items.Clear();
                TextBox_Pid.Text = "";
                TextBox_rMoney.Text = "";
                //Response.Write("<a href=\"custLogin.aspx\">去登录</a><br/>");
                //show一下会员信息

            }
            else
            {
                showResult.InnerHtml = "退货失败！";
               // Response.Write("<script>alert('退货失败！')</script>");
            }
            //Response.Write("用户名或密码错误！<a href=\"login.aspx\">返回重试</a>");
            
            conn.Close();
        }
        catch (Exception es)
        {
            showResult.InnerHtml = "出现了一点儿错误，错误信息如下：\n" + es.Message;
        }
    }
}
```



SaleManage.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="SaleManage.aspx.cs" Inherits="SaleManage" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超市-销售管理</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h1>海之星超市-销售管理</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
    <a href="show.aspx">点击返回管理员功能目录页面</a>><br /><br />

    <form id="form1" runat="server">
        <div>
            销售流水查询:
            <asp:DropDownList ID="DropDownList_Option" runat="server" AutoPostBack="true" OnSelectedIndexChanged="DropDownList_Option_SelectedIndexChanged" ></asp:DropDownList>
            开始时间:<input type="date" runat="server" id="st_date" name="st_date" />
            结束时间:<input type="date" runat="server" id="ed_date" name="ed_date" />
            <asp:Button ID="Button_Query" runat="server" Text="查询" OnClick="Button_Query_Click" />
            <asp:Button ID="Button_Reset" runat="server" Text="重置" OnClick="Button_Reset_Click" /><br />
            <p runat="server" id="showResult" name="showResult" class="showMessage"> </p>
        </div>
    </form>
</body>
</html>
```



SaleManage.aspx.cs

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class SaleManage : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if(!IsPostBack)
        {
            string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理") + "&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
            AdminInf.InnerHtml = htmlstr;

            DropDownList_Option.Items.Add("当天");
            DropDownList_Option.Items.Add("一周内");
            DropDownList_Option.Items.Add("一个月内");
            DropDownList_Option.Items.Add("自定义");
            string strDate = DateTime.Now.ToString("yyyy-MM-dd");
            st_date.Value = strDate;
            ed_date.Value = strDate;
        }
    }

    protected void Button_Reset_Click(object sender, EventArgs e)
    {
        DropDownList_Option.SelectedIndex = 0;
        string strDate = DateTime.Now.ToString("yyyy-MM-dd");
        st_date.Value = strDate;
        ed_date.Value = strDate;
        showResult.InnerHtml = "";
    }

    protected void DropDownList_Option_SelectedIndexChanged(object sender, EventArgs e)
    {
        int index = DropDownList_Option.SelectedIndex;
        if (index == 0)
        {
            st_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
            ed_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
        }
        else if (index == 1)
        {
            st_date.Value = DateTime.Now.AddDays(-7).ToString("yyyy-MM-dd");
            ed_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
        }
        else if (index == 2)
        {
            st_date.Value = DateTime.Now.AddDays(-30).ToString("yyyy-MM-dd");
            ed_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
        }
        else if (index == 3)
        {
            st_date.Value = DateTime.Now.AddDays(-365).ToString("yyyy-MM-dd");
            ed_date.Value = DateTime.Now.ToString("yyyy-MM-dd");
        }
    }

    protected void Button_Query_Click(object sender, EventArgs e)
    {
        string str_Stdate = st_date.Value;
        string str_Eddate = ed_date.Value;
        string str_TMP = str_Eddate;
        DateTime dateSt = new DateTime();
        DateTime dateEd = new DateTime();
        dateSt = DateTime.Now;
        dateEd = DateTime.Now;
        try
        {
            dateSt = Convert.ToDateTime(str_Stdate);
            dateEd = Convert.ToDateTime(str_Eddate);
        }
        catch (Exception es)
        {
            showResult.InnerHtml = "有异常。信息如下\n" + es.Message;
            return;
        }
        dateEd = dateEd.AddDays(1);
        str_Stdate = dateSt.ToString("yyyy-MM-dd");
        str_Eddate = dateEd.ToString("yyyy-MM-dd");
        string HTML = "<table><caption>【" + str_Stdate + "至" + str_TMP + "】期间的销售流水表</caption>";
        HTML += "<tr><th>序号</th><th>销售流水号</th><th>销售总金额￥</th><th>收银员编号</th><th>销售时间</th></tr>";
        Decimal totMoney = 0;
        try
        {
            //第一步，新建连接对象
            SqlConnection conn = new SqlConnection();
            //第二步，给连接对象指定参数（连接字符串）
            conn.ConnectionString = "Data Source=localhost;Initial Catalog=supermarketDB;Integrated Security=True";
            //第三步，开始建立连接
            if (conn.State != System.Data.ConnectionState.Open)
            {
                conn.Open();
            }
            SqlCommand command = new SqlCommand();
            command.Connection = conn;
            string sqlStr = "select * from SalesList where SaleDate between '{0}' and '{1}';";
            sqlStr = string.Format(sqlStr, str_Stdate, str_Eddate);
            command.CommandText = sqlStr;
            var reader = command.ExecuteReader();
            if (reader.HasRows)
            {
                int cntt = 0;
                while (reader.Read())
                {
                    ++cntt;
                    string SerialNum = reader["SerialNum"].ToString();
                    decimal money = reader.GetDecimal(1);
                    totMoney += money;
                    string TotalMoney = money.ToString();
                    string SalesPersonId = reader.GetInt32(4).ToString();
                    string SaleDate = reader.GetDateTime(5).ToString();
                    HTML += "<tr><td>" + cntt.ToString() + "</td><td>" + SerialNum + "</td><td>" + TotalMoney + "</td><td>" + SalesPersonId + "</td><td>" + SaleDate + "</td></tr>";
                }
            }
            HTML += "</table>";
            HTML += "销售总金额为:￥" + totMoney.ToString();
            showResult.InnerHtml = HTML;
            reader.Close();
            conn.Close();
        }
        catch (Exception es)
        {
            showResult.InnerHtml = "出错了！错误信息如下：\n" + es.Message;
        }
    }
}
```



show.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="show.aspx.cs" Inherits="show" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
    <title>管理员页面</title>
</head>
<body>
    <h1>管理员功能目录</h1>
    <p id="AdminInf" class="salesPersonInf" runat="server"></p>
    <p id="visiter" runat ="server"></p>
    <div style="background-color:lightpink; width: 498px; margin-left: 510px;">
        <p>
            <a href="InventoryManage.aspx" >库存-进货管理</a>
        </p>
        <p>
            <a href="ProductManage.aspx">商品管理</a>
        </p>
        <p>
            <a href="ReturnOrderManage.aspx" >退货管理</a>
        </p>
        <p>
            <a href="MemberManage.aspx">会员管理</a>
        </p>
        <p>
            <a href="CashierManage.aspx" >员工管理</a>
        </p>
        <p>
            <a href="SaleManage.aspx">销售管理</a>
        </p>
        <p id="id_ManageManage" runat="server"></p>
    </div>
    
    <form id="form1" runat="server">
       
    </form>
</body>
</html>
```



show.aspx

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;

public partial class show : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if((string)Session["AdminRoleId"]=="1")
        {
            string MangmangHtml = "<a href=\"AdminManage.aspx\" >权限管理</a>";
            id_ManageManage.InnerHtml = MangmangHtml;
        }
        string htmlstr = "管理员ID:" + Session["AdminId"] + " 管理员姓名:" + Session["AdminName"] + " 等级:" + (((string)Session["AdminRoleId"] == "2") ? "普通管理员" : "业务经理")+"&nbsp;<a href=\"Logout.aspx?identity=Admin\">注销</a>";
        AdminInf.InnerHtml = htmlstr;
        string visNumInf = "本网站当前有<b>" + Application["OnLine"].ToString() + "</b>位在线访问者&nbsp;&nbsp;" ;
        visNumInf += "累计访问量为：" + Application["TotalCount"].ToString();
        visiter.InnerHtml = visNumInf;
    }
}
```



showCustInf.aspx

```asp
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="showCustInf.aspx.cs" Inherits="showCustInf" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>海之星超-会员信息</title>
    <link rel="stylesheet" type="text/css" href="StyleSheetSupermarket.css" />
</head>
<body>
    <h2>海之星超市-会员信息</h2>
    <form id="form1" runat="server">
        <div id="inf" runat="server">
            会员你好鸭~
        </div>
    </form>
</body>
</html>

```



showCustInf.aspx

```c#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class showCustInf : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        /*
                Session["curLastTime"] = OpenTime.ToString("D");
                Session["curMemberId"] = MemberId;
                Session["curMemberAddress"] = MemberAddress;
                Session["curOpenTime"] = strOpenTime;
         */
        string HTML = "<table border=\"1px\">\n<tr><th>会员姓名：</th><td>" + Session["curMemberName"] + "</td></tr>\n";
        HTML += "<tr><th>会员卡号：</th><td>"+ Session["curMemberId"]+ "</td></tr>\n";
        HTML += "<tr><th>联系电话：</th><td>" + Session["curPhoneNumber"] + "</td></tr>\n";
        HTML += "<tr><th>家庭住址：</th><td>" + Session["curMemberAddress"] + "</td></tr>\n";
        HTML += "<tr><th>开卡日期：</th><td>" + Session["curOpenTime"] + "</td></tr>\n";
        HTML += "<tr><th>失效日期：</th><td>" + Session["curLastTime"] + "</td></tr>\n";
        HTML += "<tr><th>购物积分：</th><td>" + Session["curPoints"] + "</td></tr>\n</table>\n";
        inf.InnerHtml = HTML;
    }
}
```



